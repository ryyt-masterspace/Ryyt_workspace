[{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\scripts\\sync-plans.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'config' is assigned a value but never used.","line":2,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'resolve' is assigned a value but never used.","line":3,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":16}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":20,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":37,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":3,"column":21,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":3,"endColumn":36,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":4,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":4,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":5,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":5,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":6,"column":18,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":6,"endColumn":37,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-require-imports */\r\nconst { config } = require('dotenv');\r\nconst { resolve } = require('path');\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst Razorpay = require('razorpay');\r\n\r\n// 1. Manually Load .env.local\r\nconst envPath = path.join(__dirname, '..', '.env.local');\r\nlet envContent = '';\r\ntry {\r\n    envContent = fs.readFileSync(envPath, 'utf8');\r\n} catch (e) {\r\n    console.error(\"‚ùå Could not read .env.local file:\", e.message);\r\n    process.exit(1);\r\n}\r\n\r\nconst envVars = {};\r\nenvContent.split('\\n').forEach(line => {\r\n    const [key, ...vals] = line.split('=');\r\n    if (key && vals.length > 0) {\r\n        envVars[key.trim()] = vals.join('=').trim().replace(/(^\"|\"$)/g, ''); // strip quotes\r\n    }\r\n});\r\n\r\nconst KEY_ID = envVars.RAZORPAY_KEY_ID;\r\nconst KEY_SECRET = envVars.RAZORPAY_KEY_SECRET;\r\n\r\nif (!KEY_ID || !KEY_SECRET) {\r\n    console.error(\"‚ùå Missing RAZORPAY_KEY_ID or RAZORPAY_KEY_SECRET in .env.local\");\r\n    process.exit(1);\r\n}\r\n\r\nconsole.log(`‚úÖ Loaded Razorpay Keys from .env.local`);\r\n\r\n// 2. Fetch Plans from Razorpay\r\nconst razorpay = new Razorpay({\r\n    key_id: KEY_ID,\r\n    key_secret: KEY_SECRET,\r\n});\r\n\r\nasync function main() {\r\n    try {\r\n        console.log(\"üîÑ Fetching Plans from Razorpay...\");\r\n        const response = await razorpay.plans.all();\r\n        const activePlans = response.items;\r\n\r\n        console.log(`\\n--- Active Plans in Razorpay ---`);\r\n        activePlans.forEach(p => {\r\n            console.log(`- ${p.item.name} (${p.period}ly): ${p.id}`);\r\n        });\r\n\r\n        // 3. Compare with Configured IDs\r\n        console.log(`\\n--- Configuration Check ---`);\r\n        const checks = [\r\n            { key: 'RAZORPAY_PLAN_STARTUP', term: 'Startup', id: envVars.RAZORPAY_PLAN_STARTUP },\r\n            { key: 'RAZORPAY_PLAN_GROWTH', term: 'Growth', id: envVars.RAZORPAY_PLAN_GROWTH },\r\n            { key: 'RAZORPAY_PLAN_SCALE', term: 'Scale', id: envVars.RAZORPAY_PLAN_SCALE },\r\n        ];\r\n\r\n        let hasMismatch = false;\r\n\r\n        checks.forEach(check => {\r\n            // Find the plan in Razorpay list that looks like it (fuzzy match or manual verification needed if names differ)\r\n            // But here we rely on the ID matching.\r\n            // We want to see if the ID in env matches ANY active plan.\r\n            const matchingPlan = activePlans.find(p => p.id === check.id);\r\n\r\n            if (matchingPlan) {\r\n                console.log(`‚úÖ ${check.key}: MATCHED (${matchingPlan.item.name}) -> ${check.id}`);\r\n            } else {\r\n                console.log(`‚ùå ${check.key}: MISMATCH/INVALID -> ${check.id || '(Not Set)'}`);\r\n                hasMismatch = true;\r\n\r\n                // Try to guess the correct one?\r\n                const guess = activePlans.find(p => p.item.name.toLowerCase().includes(check.term.toLowerCase()));\r\n                if (guess) {\r\n                    console.log(`   üëâ Suggested Fix: Use ${guess.id} (${guess.item.name})`);\r\n                }\r\n            }\r\n        });\r\n\r\n        if (hasMismatch) {\r\n            console.log(\"\\n‚ö†Ô∏è  MISMATCH FOUND. Autocorrecting .env.local...\");\r\n        } else {\r\n            console.log(\"\\n‚úÖ Configuration is valid. Forcing a refresh to ensure no hidden characters...\");\r\n        }\r\n\r\n        // Force Update Logic\r\n        let newEnvContent = envContent;\r\n\r\n        // Helper to replace/add\r\n        const updateVar = (key, value) => {\r\n            const regex = new RegExp(`^${key}=.*`, 'm');\r\n            if (regex.test(newEnvContent)) {\r\n                newEnvContent = newEnvContent.replace(regex, `${key}=${value}`);\r\n            } else {\r\n                newEnvContent += `\\n${key}=${value}`;\r\n            }\r\n        };\r\n\r\n        // Find correct IDs\r\n        const startupPlan = activePlans.find(p => p.item.name.toLowerCase().includes('startup'));\r\n        const growthPlan = activePlans.find(p => p.item.name.toLowerCase().includes('growth'));\r\n        const scalePlan = activePlans.find(p => p.item.name.toLowerCase().includes('scale'));\r\n\r\n        if (startupPlan) updateVar('RAZORPAY_PLAN_STARTUP', startupPlan.id);\r\n        if (growthPlan) updateVar('RAZORPAY_PLAN_GROWTH', growthPlan.id);\r\n        if (scalePlan) updateVar('RAZORPAY_PLAN_SCALE', scalePlan.id);\r\n\r\n        fs.writeFileSync(envPath, newEnvContent, 'utf8');\r\n        console.log(\"üî• .env.local has been updated with FRESH IDs from Razorpay API.\");\r\n        console.log(\"üëâ PLEASE RESTART YOUR SERVER NOW (Ctrl+C, then npm run dev)\");\r\n\r\n    } catch (error) {\r\n        console.error(\"‚ùå API Error:\", error);\r\n    }\r\n}\r\n\r\nmain();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\(marketing)\\about\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\(marketing)\\blog\\[slug]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\(marketing)\\blog\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\(marketing)\\cancellation-refund-policy\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\(marketing)\\contact-us\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\(marketing)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\(marketing)\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\(marketing)\\privacy\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\(marketing)\\shipping-policy\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\(marketing)\\terms\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\admin\\migrate\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\api\\chat\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\api\\email\\route.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":137,"column":9,"severity":1,"nodeType":null,"fix":{"range":[7618,7680],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { NextResponse } from 'next/server';\r\nimport { Resend } from 'resend';\r\n\r\n// Initialize Resend with your API Key\r\nconst resend = new Resend(process.env.RESEND_API_KEY);\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        // 1. Security Check (Basic Bearer Token presence)\r\n        const authHeader = request.headers.get('Authorization');\r\n        if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n            return NextResponse.json({ error: 'Unauthorized: Missing Token' }, { status: 401 });\r\n        }\r\n\r\n        // 2. Parse Request Body\r\n        const body = await request.json();\r\n        const { triggerType, paymentMethod, customerEmail, merchantEmail, details } = body;\r\n\r\n        console.log(\"Email Trigger:\", { triggerType, paymentMethod, email: customerEmail });\r\n\r\n        if (!customerEmail) {\r\n            return NextResponse.json({ error: \"Missing customer email\" }, { status: 400 });\r\n        }\r\n\r\n        // 3. Define Email Content (Smart Templates & Branding)\r\n        const brandName = details?.brandName || \"Ryyt\";\r\n        const orderId = details?.orderId || \"N/A\";\r\n        const type = (triggerType || '').toString().toUpperCase();\r\n\r\n        // FIX: Subject Line\r\n        let subject = `${brandName} Refund Update: Order #${orderId}`;\r\n\r\n        // FIX: Dynamic Logo Logic\r\n        const logoHtml = details?.brandLogo\r\n            ? `<div style=\"margin-bottom: 24px;\"><img src=\"${details.brandLogo}\" alt=\"${brandName}\" style=\"max-height: 48px; border-radius: 4px;\" /></div>`\r\n            : `<div style=\"margin-bottom: 24px; font-family: sans-serif; font-size: 24px; font-weight: bold; color: #333;\">${brandName}</div>`;\r\n\r\n        // --- TEMPLATE LOGIC ---\r\n        let contentHtml = \"\";\r\n\r\n        // Scenario: COD Order Created (Needs Details)\r\n        if (type === 'GATHERING_DATA' || (type === 'CREATED' && paymentMethod === 'COD')) {\r\n            subject = `${brandName}: Action Required for Order #${orderId}`;\r\n            contentHtml = `\r\n                    <h2 style=\"margin-top: 0; color: #333;\">Refund Request Initiated</h2>\r\n                    <p>Hi, <strong>${brandName}</strong> is processing a refund of <strong>‚Çπ${details?.amount || ''}</strong> for your order #${orderId}.</p>\r\n                    <p>Since this was a Cash on Delivery order, we need your UPI details to transfer the money securely.</p>\r\n                    \r\n                    <p style=\"margin: 25px 0;\">\r\n                        <a href=\"${details?.link}\" style=\"background-color: #0052FF; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 16px; display: inline-block;\">\r\n                            Provide UPI Details\r\n                        </a>\r\n                    </p>\r\n                    \r\n                    <p style=\"font-size: 14px; color: #666;\">Or copy this link: <br/>${details?.link}</p>\r\n                    <hr style=\"border: none; border-top: 1px solid #eee; margin: 30px 0;\" />\r\n                    <p style=\"font-size: 12px; color: #999;\">Sent by the ${brandName} Support Team.</p>\r\n            `;\r\n        }\r\n\r\n        // Scenario: Details Submitted / Prepaid Created\r\n        else if (type === 'REFUND_INITIATED' || type === 'CREATED') {\r\n            contentHtml = `\r\n                    <h2 style=\"margin-top: 0; color: #333;\">Refund Initiated</h2>\r\n                    <p>We have received your details for order #${orderId}. Your refund of <strong>‚Çπ${details?.amount || ''}</strong> is now in our queue.</p>\r\n                    <p>We will notify you once <strong>${brandName}</strong> and the bank process it.</p>\r\n                    <p style=\"font-size: 12px; color: #999; margin-top: 30px;\">${brandName} Support Team</p>\r\n            `;\r\n        }\r\n\r\n        // Scenario: Processing at Bank\r\n        else if (type === 'PROCESSING_AT_BANK') {\r\n            contentHtml = `\r\n                    <h2 style=\"color: #0052FF; margin-top: 0;\">Good News!</h2>\r\n                    <p><strong>${brandName}</strong> has sent your refund request for order #${orderId} to the bank.</p>\r\n                    <p>It usually takes 2-3 business days to reflect in your account depending on your bank's processing speed.</p>\r\n                    <p style=\"font-size: 12px; color: #999; margin-top: 30px;\">${brandName} Support Team</p>\r\n            `;\r\n        }\r\n\r\n        // Scenario: Success (Settled)\r\n        else if (type === 'SETTLED') {\r\n            subject = `${brandName}: Refund Successful (Order #${orderId})`;\r\n            contentHtml = `\r\n                    <h2 style=\"color: #059669; margin-top: 0;\">Refund Credited</h2>\r\n                    <p>Your refund of <strong>‚Çπ${details?.amount || ''}</strong> for order #${orderId} has been successfully processed.</p>\r\n                    \r\n                    <div style=\"background: #f0fdf4; padding: 20px; border-radius: 8px; border: 1px solid #bbf7d0; margin: 25px 0;\">\r\n                        <p style=\"margin: 0; color: #166534; font-size: 14px;\">Reference Number (UTR)</p>\r\n                        <p style=\"margin: 5px 0 0 0; font-size: 20px; font-family: monospace; font-weight: bold; color: #15803d; letter-spacing: 1px;\">${details?.proofValue || 'N/A'}</p>\r\n                    </div>\r\n\r\n                    <p>Please check your bank statement. It should appear under the name <strong>${brandName}</strong> or its payment partner.</p>\r\n                    <p style=\"font-size: 12px; color: #999; margin-top: 30px;\">${brandName} Support Team</p>\r\n            `;\r\n        }\r\n\r\n        // Scenario: Failed\r\n        else if (type === 'FAILED') {\r\n            subject = `Action Required: Refund Failed (Order #${orderId})`;\r\n            contentHtml = `\r\n                    <h2 style=\"color: #dc2626; margin-top: 0;\">Refund Attempt Failed</h2>\r\n                    <p>We encountered an issue while processing your refund for order #${orderId}.</p>\r\n                    <p><strong>Reason:</strong> ${details?.reason || 'Incorrect UPI details or Bank Rejection'}</p>\r\n                    \r\n                    <p style=\"margin: 25px 0;\">\r\n                        <a href=\"${details?.link}\" style=\"background-color: #dc2626; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; font-weight: bold; display: inline-block;\">\r\n                            Update Payment Details\r\n                        </a>\r\n                    </p>\r\n                    \r\n                    <p>Please ensure your UPI ID is active and can receive payments. If you've updated your details, we will try again within 24 hours.</p>\r\n                    <p style=\"font-size: 12px; color: #999; margin-top: 30px;\">${brandName} Support Team</p>\r\n            `;\r\n        } else {\r\n            contentHtml = `<p>There is an update on your refund status for order #${orderId}.</p>`;\r\n        }\r\n\r\n        const html = `\r\n            <div style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; color: #1f2937; line-height: 1.6; max-width: 580px; margin: 0 auto; padding: 40px 20px; border: 1px solid #e5e7eb; border-radius: 12px;\">\r\n                ${logoHtml}\r\n                ${contentHtml}\r\n            </div>\r\n        `;\r\n\r\n        // 4. Send Email via Resend\r\n        const data = await resend.emails.send({\r\n            from: 'Ryyt Refunds <refunds@ryyt.in>', // Using Verified Domain\r\n            to: [customerEmail],\r\n            replyTo: merchantEmail || undefined,\r\n            subject: subject,\r\n            html: html,\r\n        });\r\n\r\n        return NextResponse.json(data);\r\n\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    } catch (error: unknown) {\r\n        console.error(\"Email API Error:\", error);\r\n        return NextResponse.json({ error: (error as Error).message || \"Unknown error\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\api\\razorpay\\cancel-subscription\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\api\\razorpay\\create-subscription\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\api\\razorpay\\update-subscription\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\api\\webhooks\\razorpay\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\dashboard\\active\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\dashboard\\billing\\page.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":170,"column":17,"severity":1,"nodeType":null,"fix":{"range":[8255,8317],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { doc, getDoc, collection, query, orderBy, where, getCountFromServer, onSnapshot } from \"firebase/firestore\";\r\nimport { db } from \"@/lib/firebase\";\r\nimport { useAuth } from \"@/lib/AuthContext\";\r\nimport Sidebar from \"@/components/dashboard/Sidebar\";\r\nimport { PLANS, BillingPlan } from \"@/config/plans\";\r\nimport { CreditCard, Rocket, ShieldCheck, Zap, AlertCircle, History, Info, Receipt, Loader2 } from \"lucide-react\";\r\nimport { generateInvoice, InvoiceMerchantData, InvoicePaymentData } from \"@/lib/invoiceGenerator\";\r\nimport { calculateFinalBill } from \"@/lib/taxCalculator\";\r\nimport Script from \"next/script\";\r\n\r\n\r\n// Local extension for this page\r\ninterface BillingMerchantData extends InvoiceMerchantData {\r\n    lastPaymentDate?: { seconds: number };\r\n    subscriptionStatus?: string;\r\n    planType?: string;\r\n    upcomingPlan?: string;\r\n    upcomingPlanDate?: { seconds: number; nanoseconds: number } | Date | string | number | null;\r\n    razorpaySubscriptionId?: string;\r\n}\r\n\r\nexport default function BillingPage() {\r\n    const { user } = useAuth();\r\n    const [merchant, setMerchant] = useState<BillingMerchantData | null>(null);\r\n    const [cycleUsage, setCycleUsage] = useState(0);\r\n    const [payments, setPayments] = useState<InvoicePaymentData[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const handleDownloadInvoice = async (payment: InvoicePaymentData) => {\r\n        if (!merchant) return;\r\n        try {\r\n            await generateInvoice(merchant, payment);\r\n        } catch (e) {\r\n            console.error(e);\r\n            alert(\"Could not generate invoice.\");\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (!user) return;\r\n\r\n        // 1. Real-time Merchant Listener\r\n        const mRef = doc(db, \"merchants\", user.uid);\r\n        const unsubscribeMerchant = onSnapshot(mRef, async (docSnap) => {\r\n            if (docSnap.exists()) {\r\n                const mData = docSnap.data() as BillingMerchantData;\r\n                setMerchant(mData);\r\n\r\n                // 2. Fetch Cycle Usage whenever Merchant (lastPaymentDate) changes\r\n                const lastPayDate = (mData && mData.lastPaymentDate && mData.lastPaymentDate.seconds)\r\n                    ? new Date(mData.lastPaymentDate.seconds * 1000)\r\n                    : new Date(new Date().setDate(new Date().getDate() - 30));\r\n\r\n                const refundsRef = collection(db, \"refunds\");\r\n                const cycleQuery = query(\r\n                    refundsRef,\r\n                    where(\"merchantId\", \"==\", user.uid),\r\n                    where(\"createdAt\", \">=\", lastPayDate)\r\n                );\r\n                const countSnap = await getCountFromServer(cycleQuery);\r\n                setCycleUsage(countSnap.data().count);\r\n            }\r\n            setLoading(false);\r\n        });\r\n\r\n        // 3. Real-time Payments Listener\r\n        const pRef = collection(db, \"merchants\", user.uid, \"payments\");\r\n        const pQuery = query(pRef, orderBy(\"date\", \"desc\"));\r\n        const unsubscribePayments = onSnapshot(pQuery, (snap) => {\r\n            setPayments(snap.docs.map(d => ({ id: d.id, ...d.data() } as InvoicePaymentData)));\r\n        });\r\n\r\n        return () => {\r\n            unsubscribeMerchant();\r\n            unsubscribePayments();\r\n        };\r\n    }, [user]);\r\n\r\n    const [showPlanModal, setShowPlanModal] = useState(false);\r\n    const [isUpdating, setIsUpdating] = useState(false);\r\n    const [isVerifying, setIsVerifying] = useState(false);\r\n\r\n    // Determines if we should Create New or Update Existing\r\n    const isResubscribing = merchant?.subscriptionStatus === 'cancelled' || merchant?.subscriptionStatus === 'expired' || merchant?.subscriptionStatus === 'halted';\r\n\r\n    const handleUpdatePlan = async (newPlanType: string) => {\r\n        if (!user || !merchant) return;\r\n        setIsUpdating(true);\r\n\r\n        try {\r\n            if (isResubscribing) {\r\n                // Scenario: Re-subscribing (Create New)\r\n                // We need to trigger the Razorpay Payment Modal on the frontend, usually.\r\n                // But wait, 'create-subscription' API returns a subscriptionId.\r\n                // The actual generic \"Buy\" flow usually handles the Razorpay.open() calls.\r\n                // IF this dashboard is just for \"Switching\", we might not have the full Razorpay.open() logic here?\r\n                // Let's check if we can reuse the standard checkout flow or direct to it.\r\n                // For now, let's assume we call 'create-subscription' and then we need to hand off to a payment handler.\r\n                // However, \"BillingPage\" is usually post-onboarding.\r\n                // If we create a sub here, we need to open the checkout.\r\n                // Since strict \"Re-subscription\" isn't fully scaffolded with Razorpay.js script loading here,\r\n                // ALERNATIVE: Redirect to the Onboarding/Pricing page? Or implement simple checkout here.\r\n                // Let's implement simple checkout here because redirecting is jarring.\r\n\r\n                // 1. Create Subscription\r\n                const res = await fetch('/api/razorpay/create-subscription', {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ userId: user.uid, planType: newPlanType })\r\n                });\r\n                const data = await res.json();\r\n\r\n                if (data.error) {\r\n                    alert(data.error);\r\n                    return;\r\n                }\r\n\r\n                // 2. Open Razorpay\r\n                const options = {\r\n                    key: process.env.NEXT_PUBLIC_RAZORPAY_KEY_ID || 'rzp_test_YourKeyHere', // Make sure this is available\r\n                    subscription_id: data.subscriptionId,\r\n                    name: \"Ryyt\",\r\n                    description: `${PLANS[newPlanType].name} Plan`,\r\n                    handler: function () {\r\n                        setIsVerifying(true);\r\n                        setIsUpdating(true); // Keep modal loading state too or override?\r\n\r\n                        let attempts = 0;\r\n                        const maxAttempts = 20;\r\n                        const checkStatus = setInterval(async () => {\r\n                            attempts++;\r\n                            if (attempts > maxAttempts) {\r\n                                clearInterval(checkStatus);\r\n                                window.location.reload();\r\n                                return;\r\n                            }\r\n                            try {\r\n                                if (user) {\r\n                                    // We can use the existing 'getDoc' import or ensure it is imported.\r\n                                    // Assuming getDoc is imported from correct module.\r\n                                    // It IS imported from \"firebase/firestore\" in line 5.\r\n                                    const verifySnap = await getDoc(doc(db, \"merchants\", user.uid));\r\n                                    if (verifySnap.exists() && verifySnap.data().subscriptionStatus === 'active') {\r\n                                        clearInterval(checkStatus);\r\n                                        alert(\"Subscription Reactivated!\");\r\n                                        window.location.reload();\r\n                                    }\r\n                                }\r\n                            } catch (e) { console.error(e); }\r\n                        }, 1000);\r\n                    },\r\n                    modal: {\r\n                        ondismiss: function () {\r\n                            if (!isVerifying) setIsUpdating(false); // Only dismiss if not verifying\r\n                        }\r\n                    }\r\n                };\r\n\r\n                // We need window.Razorpay. If not loaded, we might error.\r\n                // Assuming it's loaded in layout or we need to load it. \r\n                // For safety, let's alert if missing.\r\n                if (!(window as unknown as { Razorpay: unknown }).Razorpay) {\r\n                    alert(\"Payment SDK not loaded. Please refresh.\");\r\n                    return;\r\n                }\r\n\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                const rzp1 = new (window as unknown as { Razorpay: new (options: unknown) => { open: () => void } }).Razorpay(options);\r\n                rzp1.open();\r\n\r\n            } else {\r\n                // Scenario: Updating Active Subscription\r\n                const res = await fetch('/api/razorpay/update-subscription', {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ userId: user.uid, newPlanType })\r\n                });\r\n\r\n                const data = await res.json();\r\n                if (data.success) {\r\n                    alert(data.mode === 'upgrade'\r\n                        ? \"Upgrade successful! Your new limits are active.\"\r\n                        : `Downgrade scheduled for ${new Date(data.effectiveDate).toLocaleDateString()}.`);\r\n                    window.location.reload();\r\n                } else {\r\n                    if (data.error === 'UPI_RESTRICTION') {\r\n                        alert(\"UPI Limitation: Automatic switching is not supported on UPI. Please Cancel your current plan and subscribe to the new one.\");\r\n                    } else {\r\n                        alert(data.error || \"Failed to change plan.\");\r\n                    }\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error(err);\r\n            alert(\"An error occurred.\");\r\n        } finally {\r\n            if (!isResubscribing) { // If resubscribing, 'finally' happens after modal dismiss usually, but here we clear loader\r\n                setIsUpdating(false);\r\n                setShowPlanModal(false);\r\n            }\r\n        }\r\n    };\r\n\r\n    if (loading) return <div className=\"min-h-screen bg-[#050505] text-white flex items-center justify-center\">Loading...</div>;\r\n\r\n    const currentPlanKey = merchant?.planType || \"startup\";\r\n    const plan: BillingPlan = PLANS[currentPlanKey];\r\n    const usage = cycleUsage;\r\n    const limit = plan.includedRefunds;\r\n    const usagePercent = Math.min((usage / limit) * 100, 100);\r\n\r\n    // Date Logic\r\n    const lastPayment = merchant?.lastPaymentDate?.seconds\r\n        ? new Date(merchant.lastPaymentDate.seconds * 1000)\r\n        : new Date();\r\n\r\n    const nextRenewal = new Date(lastPayment);\r\n    nextRenewal.setDate(nextRenewal.getDate() + 30);\r\n\r\n    // Task 5: Upgrade Cost Preview\r\n    const getUpgradePratatedCost = (targetPlan: BillingPlan) => {\r\n        const remainingDays = Math.max(1, Math.ceil((nextRenewal.getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24)));\r\n        const diff = targetPlan.basePrice - plan.basePrice;\r\n        if (diff <= 0) return 0;\r\n        const prorated = (diff / 30) * remainingDays;\r\n        return calculateFinalBill(prorated).total;\r\n    };\r\n\r\n    // Calculations\r\n    const overageCount = Math.max(0, usage - limit);\r\n    const overageFee = overageCount * plan.excessRate;\r\n    const baseFee = plan.basePrice;\r\n\r\n    // Centralized GST Math\r\n    const { subtotal, gstAmount, total: totalUpcoming } = calculateFinalBill(baseFee + overageFee);\r\n\r\n    return (\r\n        <div className=\"flex min-h-screen bg-[#050505]\">\r\n            <Sidebar />\r\n\r\n            <main className=\"flex-1 ml-[64px] md:ml-[240px] p-8 bg-[#050505] text-white transition-all duration-300\">\r\n                <Script src=\"https://checkout.razorpay.com/v1/checkout.js\" />\r\n                <div className=\"max-w-4xl mx-auto space-y-8\">\r\n\r\n                    {/* Pending Change Alert */}\r\n                    {/* Upcoming Plan Change Banner */}\r\n                    {merchant?.upcomingPlan && (\r\n                        <div className=\"bg-amber-500/10 border border-amber-500/20 p-4 rounded-2xl flex items-center justify-between mb-8\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <AlertCircle className=\"text-amber-500\" size={20} />\r\n                                <div>\r\n                                    <p className=\"text-sm font-bold text-amber-500\">Scheduled Plan Change</p>\r\n                                    <p className=\"text-xs text-amber-500/80\">\r\n                                        Your subscription will switch to <strong>{PLANS[merchant.upcomingPlan].name}</strong> on {(() => {\r\n                                            const effectiveDate = merchant.upcomingPlanDate;\r\n                                            try {\r\n                                                const dateObj = (effectiveDate as unknown as { toDate?: () => Date })?.toDate\r\n                                                    ? (effectiveDate as unknown as { toDate: () => Date }).toDate()\r\n                                                    : (effectiveDate ? new Date(effectiveDate as string | number | Date) : null);\r\n                                                if (!dateObj || isNaN(dateObj.getTime())) return nextRenewal.toLocaleDateString('en-IN', { day: 'numeric', month: 'long', year: 'numeric' });\r\n                                                return dateObj.toLocaleDateString('en-IN', { day: 'numeric', month: 'long', year: 'numeric' });\r\n                                            } catch {\r\n                                                return nextRenewal.toLocaleDateString('en-IN', { day: 'numeric', month: 'long', year: 'numeric' });\r\n                                            }\r\n                                        })()}.\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Header */}\r\n                    <div>\r\n                        <h1 className=\"text-3xl font-bold tracking-tight mb-2\">Billing & Subscription</h1>\r\n                        <p className=\"text-gray-400\">Manage your plan and monitor monthly volume usage.</p>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n\r\n                        {/* Current Plan Card */}\r\n                        <div className=\"md:col-span-2 space-y-6\">\r\n                            <div className=\"bg-[#0A0A0A] border border-white/5 rounded-2xl p-6 relative overflow-hidden group\">\r\n                                <div className=\"absolute top-0 right-0 p-6 opacity-5 group-hover:opacity-10 transition-opacity\">\r\n                                    <Zap size={120} />\r\n                                </div>\r\n\r\n                                <div className=\"flex justify-between items-start mb-8\">\r\n                                    <div>\r\n                                        <p className=\"text-[10px] text-blue-400 font-bold uppercase tracking-[0.2em] mb-1\">Current Plan</p>\r\n                                        <h2 className=\"text-3xl font-bold text-white\">{plan.name}</h2>\r\n                                    </div>\r\n                                    <div className=\"bg-blue-600/10 text-blue-400 px-3 py-1 rounded-full text-xs font-bold border border-blue-500/20\">\r\n                                        {(merchant?.subscriptionStatus || \"ACTIVE\").toUpperCase()}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-2 gap-8 mb-8\">\r\n                                    <div>\r\n                                        <p className=\"text-xs text-gray-500 mb-1\">Monthly Base</p>\r\n                                        <p className=\"text-xl font-bold text-white\">‚Çπ{plan.basePrice.toLocaleString()}</p>\r\n                                    </div>\r\n                                    <div>\r\n                                        <p className=\"text-xs text-gray-500 mb-1\">Included Refunds</p>\r\n                                        <p className=\"text-xl font-bold text-white\">{plan.includedRefunds}</p>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <div className=\"flex justify-between text-xs font-medium\">\r\n                                        <span className=\"text-zinc-500\">\r\n                                            Cycle: {lastPayment.toLocaleDateString('en-IN', { day: 'numeric', month: 'short' })} - {nextRenewal.toLocaleDateString('en-IN', { day: 'numeric', month: 'short' })}\r\n                                        </span>\r\n                                        <span className={usage > limit ? \"text-orange-400\" : \"text-blue-400\"}>\r\n                                            {usage} / {limit} Refunds\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"h-2 w-full bg-white/5 rounded-full overflow-hidden border border-white/5\">\r\n                                        <div\r\n                                            className={`h-full transition-all duration-500 ${usage > limit ? \"bg-orange-500\" : \"bg-blue-600\"}`}\r\n                                            style={{ width: `${usagePercent}%` }}\r\n                                        ></div>\r\n                                    </div>\r\n                                    {usage > limit && (\r\n                                        <p className=\"text-[10px] text-orange-400 flex items-center gap-1 mt-2 font-mono\">\r\n                                            <AlertCircle size={10} /> {overageCount} EXCESS UNITS DETECTED (‚Çπ{plan.excessRate}/ea)\r\n                                        </p>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Transparent Upcoming Bill Breakdown */}\r\n                            <div className=\"bg-[#0A0A0A] border border-white/5 rounded-2xl p-6 relative\">\r\n                                <div className=\"flex justify-between items-center mb-6\">\r\n                                    <h3 className=\"text-lg font-bold flex items-center gap-2\">\r\n                                        <CreditCard size={18} className=\"text-gray-400\" />\r\n                                        Calculated Upcoming Bill\r\n                                    </h3>\r\n                                    <div className=\"text-right\">\r\n                                        <p className=\"text-[10px] text-gray-500 uppercase font-bold tracking-widest\">Renewal Date</p>\r\n                                        <p className=\"text-sm font-mono text-white\">{nextRenewal.toLocaleDateString('en-IN', { day: 'numeric', month: 'long', year: 'numeric' })}</p>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-4 bg-white/[0.02] border border-white/5 rounded-xl p-4\">\r\n                                    <div className=\"flex justify-between text-sm\">\r\n                                        <div className=\"space-y-0.5\">\r\n                                            <p className=\"text-gray-300 font-medium\">{plan.name} Subscription</p>\r\n                                            <p className=\"text-[10px] text-gray-500\">Prepaid for next 30 days</p>\r\n                                        </div>\r\n                                        <span className=\"font-mono text-white\">‚Çπ{baseFee.toLocaleString()}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between text-sm\">\r\n                                        <div className=\"space-y-0.5\">\r\n                                            <p className=\"text-gray-300 font-medium\">Usage Overages</p>\r\n                                            <p className=\"text-[10px] text-gray-500\">{overageCount} refunds above {limit} limit</p>\r\n                                        </div>\r\n                                        <span className=\"font-mono text-orange-400\">+ ‚Çπ{overageFee.toLocaleString()}</span>\r\n                                    </div>\r\n\r\n                                    <div className=\"h-px bg-white/5 my-2\"></div>\r\n\r\n                                    <div className=\"flex justify-between items-end\">\r\n                                        <div>\r\n                                            <p className=\"text-[10px] text-gray-500 font-bold uppercase tracking-widest mb-1\">Subtotal (Net)</p>\r\n                                            <p className=\"text-sm font-bold text-white mb-2\">‚Çπ{subtotal.toLocaleString()}</p>\r\n\r\n                                            <p className=\"text-[10px] text-gray-500 font-bold uppercase tracking-widest mb-1\">GST (18%)</p>\r\n                                            <p className=\"text-sm font-bold text-white mb-3\">‚Çπ{gstAmount.toLocaleString()}</p>\r\n\r\n                                            <p className=\"text-xs text-indigo-400 font-bold uppercase tracking-widest\">Total Upcoming Bill</p>\r\n                                            <p className=\"text-3xl font-bold text-blue-400\">‚Çπ{totalUpcoming.toLocaleString()}</p>\r\n                                        </div>\r\n                                        <div className=\"text-right\">\r\n                                            <p className=\"text-[10px] text-gray-500 font-bold\">DUE ON RENEWAL</p>\r\n                                            <p className=\"text-sm font-mono text-white\">{nextRenewal.toLocaleDateString('en-IN', { day: 'numeric', month: 'short' })}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"mt-6 p-4 bg-blue-600/10 border border-blue-500/20 rounded-xl\">\r\n                                    <p className=\"text-sm font-bold text-blue-400 mb-1 flex items-center gap-2\">\r\n                                        <Zap size={14} /> Automated Billing Active\r\n                                    </p>\r\n                                    <p className=\"text-[10px] text-gray-400 leading-relaxed\">\r\n                                        Your subscription is managed via Razorpay. Overage charges are calculated and billed automatically at the end of each cycle.\r\n                                    </p>\r\n                                </div>\r\n                                <p className=\"text-[10px] text-gray-600 mt-4 flex items-center gap-1.5 italic\">\r\n                                    <Info size={12} /> This is a live estimation based on current cycle activity.\r\n                                </p>\r\n                            </div>\r\n\r\n                            {/* Transaction History Section */}\r\n                            <div className=\"bg-[#0A0A0A] border border-white/5 rounded-2xl overflow-hidden\">\r\n                                <div className=\"p-6 border-b border-white/5 bg-white/[0.02] flex justify-between items-center\">\r\n                                    <h3 className=\"text-lg font-bold flex items-center gap-2\">\r\n                                        <History size={18} className=\"text-gray-400\" />\r\n                                        Past Payments\r\n                                    </h3>\r\n                                    <span className=\"text-[10px] text-zinc-500 font-mono\">Official Ledger</span>\r\n                                </div>\r\n\r\n                                <div className=\"overflow-x-auto\">\r\n                                    <table className=\"w-full text-left border-collapse\">\r\n                                        <thead>\r\n                                            <tr className=\"bg-black/20 text-[10px] text-gray-500 uppercase tracking-widest border-b border-white/5\">\r\n                                                <th className=\"px-6 py-4 font-bold\">Date</th>\r\n                                                <th className=\"px-6 py-4 font-bold\">Amount</th>\r\n                                                <th className=\"px-6 py-4 font-bold\">Plan</th>\r\n                                                <th className=\"px-6 py-4 font-bold text-center\">Receipt</th>\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody className=\"divide-y divide-white/5\">\r\n                                            {payments.length === 0 ? (\r\n                                                <tr>\r\n                                                    <td colSpan={4} className=\"px-6 py-12 text-center text-gray-600 text-sm\">\r\n                                                        No payment records found.\r\n                                                    </td>\r\n                                                </tr>\r\n                                            ) : (\r\n                                                payments.map((p) => (\r\n                                                    <tr key={p.id} className=\"hover:bg-white/[0.02] transition-colors\">\r\n                                                        <td className=\"px-6 py-4 text-sm font-mono text-gray-400\">\r\n                                                            {(p.date as { seconds: number })?.seconds ? new Date((p.date as { seconds: number }).seconds * 1000).toLocaleDateString() : 'Processing'}\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4 font-mono text-white\">\r\n                                                            ‚Çπ{p.amount?.toLocaleString()}\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4 text-xs font-bold text-white uppercase tracking-wider\">\r\n                                                            {p.planName}\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4\">\r\n                                                            <div className=\"flex justify-center\">\r\n                                                                <button\r\n                                                                    onClick={() => handleDownloadInvoice(p)}\r\n                                                                    className=\"flex items-center gap-1.5 text-[10px] font-bold text-blue-400 hover:text-blue-300 transition-colors\"\r\n                                                                >\r\n                                                                    <div className=\"p-1 bg-blue-500/10 rounded-md\">\r\n                                                                        <Receipt size={12} />\r\n                                                                    </div>\r\n                                                                    Download XML/PDF\r\n                                                                </button>\r\n                                                            </div>\r\n                                                        </td>\r\n                                                    </tr>\r\n                                                ))\r\n                                            )}\r\n                                        </tbody>\r\n                                    </table>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Upgrade Perks / Right Sidebar */}\r\n                        <div className=\"space-y-6\">\r\n                            <div className=\"bg-blue-600/5 border border-blue-500/10 rounded-2xl p-6\">\r\n                                <Rocket size={32} className=\"text-blue-500 mb-4\" />\r\n                                <h4 className=\"font-bold text-white mb-2\">{isResubscribing ? 'Reactivate Subscription' : 'Modify Subscription'}</h4>\r\n                                <p className=\"text-sm text-gray-500 leading-relaxed mb-6\">\r\n                                    {isResubscribing\r\n                                        ? \"Your plan is currently inactive. Select a plan to restore access immediately.\"\r\n                                        : \"Switch your plan to better align with your monthly refund volume.\"}\r\n                                </p>\r\n                                <button\r\n                                    onClick={() => setShowPlanModal(true)}\r\n                                    className=\"w-full py-3 bg-blue-600 text-white rounded-xl text-sm font-bold hover:bg-blue-500 transition-all shadow-lg shadow-blue-600/20\"\r\n                                >\r\n                                    Change Plan\r\n                                </button>\r\n                                {!isResubscribing && (\r\n                                    <CancelButton subscriptionId={merchant?.razorpaySubscriptionId} userId={user?.uid || ''} />\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"p-6 border border-white/5 rounded-2xl bg-white/2\">\r\n                                <h4 className=\"text-xs font-bold text-gray-500 uppercase tracking-widest mb-4\">Enterprise Security</h4>\r\n                                <ul className=\"space-y-3\">\r\n                                    <li className=\"flex items-center gap-2 text-xs text-gray-400\">\r\n                                        <ShieldCheck size={14} className=\"text-emerald-500\" /> PCI-DSS Compliant Infrastructure\r\n                                    </li>\r\n                                    <li className=\"flex items-center gap-2 text-xs text-gray-400\">\r\n                                        <ShieldCheck size={14} className=\"text-emerald-500\" /> Automated Reconciliation\r\n                                    </li>\r\n                                    <li className=\"flex items-center gap-2 text-xs text-gray-400\">\r\n                                        <ShieldCheck size={14} className=\"text-emerald-500\" /> Multi-Tenant Data Isolation\r\n                                    </li>\r\n                                </ul>\r\n                            </div>\r\n                        </div>\r\n\r\n                    </div>\r\n                </div>\r\n\r\n\r\n                {/* Task 1: Change Plan Modal */}\r\n                {\r\n                    showPlanModal && (\r\n                        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm\">\r\n                            <div className=\"bg-[#0A0A0A] border border-white/10 rounded-3xl w-full max-w-2xl overflow-hidden shadow-2xl\">\r\n                                {isVerifying ? (\r\n                                    <div className=\"p-12 text-center\">\r\n                                        <Loader2 className=\"animate-spin text-blue-500 mx-auto mb-4\" size={48} />\r\n                                        <h2 className=\"text-2xl font-bold text-white mb-2\">Verifying Payment</h2>\r\n                                        <p className=\"text-gray-400\">Please wait while we sync your subscription...</p>\r\n                                    </div>\r\n                                ) : (\r\n                                    <>\r\n                                        <div className=\"p-8 border-b border-white/5 flex justify-between items-center\">\r\n                                            <div>\r\n                                                <h2 className=\"text-2xl font-bold\">Select New Plan</h2>\r\n                                                <p className=\"text-sm text-gray-500\">Choose the best fit for your growth.</p>\r\n                                            </div>\r\n                                            <button onClick={() => setShowPlanModal(false)} className=\"text-gray-500 hover:text-white transition-colors\">\r\n                                                <Zap className=\"rotate-45\" size={24} />\r\n                                            </button>\r\n                                        </div>\r\n\r\n                                        <div className=\"p-8 grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                                            {Object.entries(PLANS).map(([key, p]) => {\r\n                                                const isCurrent = key === currentPlanKey;\r\n                                                const isUpgrade = p.basePrice > plan.basePrice;\r\n                                                const upgradeCost = getUpgradePratatedCost(p);\r\n\r\n                                                return (\r\n                                                    <div\r\n                                                        key={key}\r\n                                                        className={`p-6 rounded-2xl border transition-all ${isCurrent ? 'border-blue-500 bg-blue-500/5' : 'border-white/5 bg-white/[0.02] hover:border-white/10'}`}\r\n                                                    >\r\n                                                        <div className=\"mb-4\">\r\n                                                            <h3 className=\"font-bold text-lg\">{p.name}</h3>\r\n                                                            <p className=\"text-xl font-mono\">‚Çπ{p.basePrice}</p>\r\n                                                        </div>\r\n\r\n                                                        <ul className=\"text-[10px] space-y-2 text-gray-400 mb-6\">\r\n                                                            <li>‚Ä¢ {p.includedRefunds} Refunds/mo</li>\r\n                                                            <li>‚Ä¢ ‚Çπ{p.excessRate} Overage Rate</li>\r\n                                                        </ul>\r\n\r\n                                                        {isCurrent ? (\r\n                                                            <div className=\"w-full py-2 text-center text-[10px] font-bold text-blue-400 uppercase tracking-widest bg-blue-500/10 rounded-lg\">\r\n                                                                Current Plan\r\n                                                            </div>\r\n                                                        ) : (\r\n                                                            <button\r\n                                                                onClick={() => handleUpdatePlan(key)}\r\n                                                                disabled={isUpdating}\r\n                                                                className=\"w-full py-2 bg-white text-black rounded-lg text-xs font-bold hover:bg-gray-200 transition-colors disabled:opacity-50\"\r\n                                                            >\r\n                                                                {isUpdating ? 'Wait...' : 'Switch'}\r\n                                                            </button>\r\n                                                        )}\r\n\r\n                                                        {!isCurrent && isUpgrade && upgradeCost > 0 && (\r\n                                                            <p className=\"mt-3 text-[9px] text-emerald-400 leading-tight\">\r\n                                                                Upgrade now for ‚Çπ{upgradeCost.toFixed(0)}* proration\r\n                                                            </p>\r\n                                                        )}\r\n                                                    </div>\r\n                                                );\r\n                                            })}\r\n                                        </div>\r\n\r\n                                        <div className=\"p-6 bg-white/[0.02] border-t border-white/5 space-y-4\">\r\n                                            <div className=\"flex gap-3\">\r\n                                                <div className=\"p-2 bg-blue-500/10 rounded-lg h-fit\">\r\n                                                    <Info size={16} className=\"text-blue-400\" />\r\n                                                </div>\r\n                                                <div className=\"space-y-1\">\r\n                                                    <p className=\"text-xs font-bold text-white\">How charges work:</p>\r\n                                                    <p className=\"text-[10px] text-gray-400 leading-relaxed\">\r\n                                                        <strong>Upgrades:</strong> You will be charged the prorated difference for the remainder of this month immediately to activate your new limits.\r\n                                                    </p>\r\n                                                    <p className=\"text-[10px] text-gray-400 leading-relaxed\">\r\n                                                        <strong>Downgrades:</strong> Your plan change will take effect on your next billing date ({nextRenewal.toLocaleDateString()}).\r\n                                                    </p>\r\n                                                </div>\r\n                                            </div>\r\n                                            <p className=\"text-[9px] text-gray-600 italic\">* Estimated cost includes 18% GST. Actual charge may vary by a few rupees based on exact timing.</p>\r\n                                        </div>\r\n                                    </>)}\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                }\r\n            </main >\r\n        </div >\r\n    );\r\n}\r\n\r\n// Button Component in Main Render\r\nfunction CancelButton({ subscriptionId, userId }: { subscriptionId?: string, userId: string }) {\r\n    const [isCancelling, setIsCancelling] = useState(false);\r\n\r\n    if (!subscriptionId) return null;\r\n\r\n    const handleCancel = async () => {\r\n        if (!confirm(\"Are you sure you want to cancel your subscription? You will lose access to premium features immediately.\")) return;\r\n\r\n        setIsCancelling(true);\r\n        try {\r\n            const res = await fetch('/api/razorpay/cancel-subscription', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ subscriptionId, userId })\r\n            });\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                alert(\"Subscription cancelled successfully.\");\r\n                window.location.reload();\r\n            } else {\r\n                alert(data.error || \"Failed to cancel.\");\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            alert(\"An error occurred.\");\r\n        } finally {\r\n            setIsCancelling(false);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <button\r\n            onClick={handleCancel}\r\n            disabled={isCancelling}\r\n            className=\"w-full mt-3 py-3 bg-red-900/20 text-red-500 border border-red-500/20 rounded-xl text-sm font-bold hover:bg-red-900/30 transition-all font-mono uppercase tracking-widest text-[10px]\"\r\n        >\r\n            {isCancelling ? 'Processing...' : 'Cancel Subscription'}\r\n        </button>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\dashboard\\breaches\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\dashboard\\failures\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\dashboard\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\dashboard\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_renderCustomizedLabel' is assigned a value but never used.","line":25,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_loadingMetrics' is assigned a value but never used.","line":50,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'metricsError' is assigned a value but never used.","line":50,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":67}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { getAuth, onAuthStateChanged } from \"firebase/auth\";\r\nimport { app } from \"@/lib/firebase\";\r\nimport Sidebar from \"@/components/dashboard/Sidebar\";\r\nimport CreateRefundModal from \"@/components/dashboard/CreateRefundModal\";\r\nimport BulkImportModal from \"@/components/dashboard/BulkImportModal\";\r\nimport RefundMethodModal from \"@/components/dashboard/RefundMethodModal\";\r\nimport { useDashboardMetrics } from \"@/hooks/useDashboardMetrics\";\r\nimport {\r\n    AreaChart, Area, PieChart, Pie, Cell, Tooltip, XAxis, YAxis, ResponsiveContainer, BarChart, Bar\r\n} from 'recharts';\r\nimport {\r\n    Activity, TrendingUp, AlertTriangle, ArrowUpRight, Plus, WifiOff, UserX, CheckCircle2, RefreshCw, Wallet\r\n} from \"lucide-react\";\r\nimport Button from \"@/components/ui/Button\";\r\nimport BulkUpdateModal from \"@/components/dashboard/BulkUpdateModal\";\r\n\r\n// Colors for Pie Chart\r\nconst COLORS = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];\r\nconst RADIAN = Math.PI / 180;\r\n\r\nconst _renderCustomizedLabel = ({ cx, cy, midAngle, innerRadius, outerRadius, percent }: { cx: number, cy: number, midAngle: number, innerRadius: number, outerRadius: number, percent: number }) => {\r\n    const radius = innerRadius + (outerRadius - innerRadius) * 0.5;\r\n    const x = cx + radius * Math.cos(-midAngle * RADIAN);\r\n    const y = cy + radius * Math.sin(-midAngle * RADIAN);\r\n\r\n    return percent > 0.05 ? (\r\n        <text x={x} y={y} fill=\"white\" textAnchor={x > cx ? 'start' : 'end'} dominantBaseline=\"central\" className=\"text-[10px] font-bold\">\r\n            {`${(percent * 100).toFixed(0)}%`}\r\n        </text>\r\n    ) : null;\r\n};\r\n\r\nexport default function DashboardPage() {\r\n    const [user, setUser] = useState<import('firebase/auth').User | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [isCreateModalOpen, setIsCreateModalOpen] = useState(false);\r\n    const [isImportModalOpen, setIsImportModalOpen] = useState(false);\r\n    const [isUpdateModalOpen, setIsUpdateModalOpen] = useState(false);\r\n    const [isMethodModalOpen, setIsMethodModalOpen] = useState(false);\r\n    const [volumeRange, setVolumeRange] = useState<number>(30);\r\n\r\n    const router = useRouter();\r\n    const auth = getAuth(app);\r\n\r\n    // Data Hook (Auto-fetches when user is set)\r\n    const { metrics, loading: _loadingMetrics, error: metricsError } = useDashboardMetrics(volumeRange);\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = onAuthStateChanged(auth, (currentUser) => {\r\n            if (!currentUser) {\r\n                router.push(\"/login\");\r\n            } else {\r\n                setUser(currentUser);\r\n            }\r\n            setLoading(false);\r\n        });\r\n        return () => unsubscribe();\r\n    }, [auth, router]);\r\n\r\n    const handleMethodSelect = (method: 'manual' | 'bulk') => {\r\n        setIsMethodModalOpen(false);\r\n        if (method === 'manual') setIsCreateModalOpen(true);\r\n        if (method === 'bulk') setIsImportModalOpen(true);\r\n    };\r\n\r\n    if (loading) return <div className=\"min-h-screen bg-[#050505] text-white flex items-center justify-center\">Authenticating...</div>;\r\n    if (!user) return null;\r\n\r\n    return (\r\n        <div className=\"flex min-h-screen bg-[#050505]\">\r\n            <Sidebar />\r\n\r\n            <main className=\"flex-1 ml-[64px] md:ml-[240px] bg-[#050505] text-white\">\r\n                <div className=\"p-6 space-y-8 max-w-[1600px] mx-auto min-h-screen\">\r\n\r\n                    {/* 1. HEADER SECTION */}\r\n                    <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\r\n                        <div>\r\n                            <h1 className=\"text-2xl font-bold text-white\">Analytics Overview</h1>\r\n                            <div className=\"flex items-center gap-2 text-zinc-400 text-sm mt-1\">\r\n                                <span className=\"w-2 h-2 rounded-full bg-emerald-500\"></span>\r\n                                Live Data ‚Ä¢ All Time\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Actions Group */}\r\n                        <div className=\"flex gap-3\">\r\n                            <Button onClick={() => setIsUpdateModalOpen(true)} className=\"bg-zinc-800 hover:bg-zinc-700 text-white border border-zinc-700\">\r\n                                <RefreshCw className=\"w-4 h-4 mr-2\" /> Update Status\r\n                            </Button>\r\n                            <Button onClick={() => setIsMethodModalOpen(true)} className=\"bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-500/20\">\r\n                                <Plus className=\"w-4 h-4 mr-2\" /> New Refund\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* 2. METRICS ROW */}\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                        <div className=\"bg-zinc-900/50 border border-zinc-800 p-5 rounded-xl flex flex-col justify-between relative overflow-hidden group hover:border-zinc-700 transition-colors\">\r\n                            <div className=\"flex justify-between items-start mb-2\">\r\n                                <div className=\"text-zinc-400 text-xs font-medium uppercase tracking-wider\">Total Settled</div>\r\n                                <div className=\"p-2 bg-emerald-500/10 rounded-lg text-emerald-500\">\r\n                                    <Wallet size={18} />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"text-3xl font-bold text-white mb-1\">\r\n                                ‚Çπ{metrics?.totalSettledAmount?.toLocaleString('en-IN') || 0}\r\n                            </div>\r\n                            <div>\r\n                                <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium bg-emerald-500/10 text-emerald-500\">\r\n                                    <ArrowUpRight size={12} /> Secured\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-zinc-900/50 border border-zinc-800 p-5 rounded-xl flex flex-col justify-between relative overflow-hidden group hover:border-zinc-700 transition-colors\">\r\n                            <div className=\"flex justify-between items-start mb-2\">\r\n                                <div className=\"text-zinc-400 text-xs font-medium uppercase tracking-wider\">Active Liability</div>\r\n                                <div className=\"p-2 bg-orange-500/10 rounded-lg text-orange-500\">\r\n                                    <Activity size={18} />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"text-3xl font-bold text-orange-400 mb-1\">\r\n                                ‚Çπ{metrics?.activeLiability?.toLocaleString('en-IN') || 0}\r\n                            </div>\r\n                            <div>\r\n                                <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium bg-orange-500/10 text-orange-500\">\r\n                                    <Activity size={12} /> In-Flight\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-zinc-900/50 border border-zinc-800 p-5 rounded-xl flex flex-col justify-between relative overflow-hidden group hover:border-zinc-700 transition-colors\">\r\n                            <div className=\"flex justify-between items-start mb-2\">\r\n                                <div className=\"text-zinc-400 text-xs font-medium uppercase tracking-wider\">Total Refund Count</div>\r\n                                <div className=\"p-2 bg-blue-500/10 rounded-lg text-blue-500\">\r\n                                    <TrendingUp size={18} />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"text-3xl font-bold text-blue-400 mb-1\">\r\n                                {metrics?.totalRefunds || 0}\r\n                            </div>\r\n                            <div>\r\n                                <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium bg-blue-500/10 text-blue-500\">\r\n                                    <TrendingUp size={12} /> Lifetime\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-zinc-900/50 border border-zinc-800 p-5 rounded-xl flex flex-col justify-between relative overflow-hidden group hover:border-zinc-700 transition-colors\">\r\n                            <div className=\"flex justify-between items-start mb-2\">\r\n                                <div className=\"text-zinc-400 text-xs font-medium uppercase tracking-wider\">SLA Breaches</div>\r\n                                <div className=\"p-2 bg-red-500/10 rounded-lg text-red-500\">\r\n                                    <AlertTriangle size={18} />\r\n                                </div>\r\n                            </div>\r\n                            <div className={`text-3xl font-bold mb-1 ${metrics?.slaBreachCount ? 'text-red-500' : 'text-zinc-500'}`}>\r\n                                {metrics?.slaBreachCount || 0}\r\n                            </div>\r\n                            <div>\r\n                                <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium ${metrics?.slaBreachCount ? 'bg-red-500/10 text-red-500' : 'bg-zinc-800 text-zinc-500'}`}>\r\n                                    <AlertTriangle size={12} /> Action Required\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* 3. CHARTS ROW */}\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                        {/* Volume Chart (Left 2/3) */}\r\n                        <div className=\"lg:col-span-2 bg-zinc-900/50 border border-zinc-800 p-6 rounded-xl h-[400px]\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h3 className=\"text-lg font-semibold text-white\">Volume Trend</h3>\r\n                                <select\r\n                                    value={volumeRange}\r\n                                    onChange={(e) => setVolumeRange(Number(e.target.value))}\r\n                                    className=\"bg-zinc-800 border border-zinc-700 text-xs text-white rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-600 appearance-none cursor-pointer\"\r\n                                >\r\n                                    <option value={7}>Last 7 Days</option>\r\n                                    <option value={14}>Last 14 Days</option>\r\n                                    <option value={30}>Last 30 Days</option>\r\n                                    <option value={90}>Last 3 Months</option>\r\n                                    <option value={180}>Last 6 Months</option>\r\n                                    <option value={365}>Last Year</option>\r\n                                </select>\r\n                            </div>\r\n                            <div className=\"h-[300px] w-full\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <AreaChart data={metrics?.volumeData || []}>\r\n                                        <defs>\r\n                                            <linearGradient id=\"colorCount\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                                <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.3} />\r\n                                                <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0} />\r\n                                            </linearGradient>\r\n                                        </defs>\r\n                                        <XAxis dataKey=\"date\" stroke=\"#52525b\" fontSize={12} tickLine={false} axisLine={false} />\r\n                                        <Tooltip\r\n                                            contentStyle={{ backgroundColor: '#18181b', border: '1px solid #27272a', borderRadius: '8px' }}\r\n                                            itemStyle={{ color: '#fff' }}\r\n                                        />\r\n                                        <Area type=\"monotone\" dataKey=\"count\" stroke=\"#3b82f6\" strokeWidth={2} fillOpacity={1} fill=\"url(#colorCount)\" />\r\n                                    </AreaChart>\r\n                                </ResponsiveContainer>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Payment Mix (Right 1/3) */}\r\n                        <div className=\"bg-zinc-900/50 border border-zinc-800 p-6 rounded-xl flex flex-col h-[400px]\">\r\n                            <h3 className=\"text-lg font-semibold text-white mb-2\">Payment Method Mix</h3>\r\n                            <div className=\"flex-1 w-full min-h-0 relative\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <PieChart>\r\n                                        <Pie\r\n                                            data={metrics?.methodData || []}\r\n                                            cx=\"50%\"\r\n                                            cy=\"50%\"\r\n                                            innerRadius={60}\r\n                                            outerRadius={80}\r\n                                            paddingAngle={5}\r\n                                            dataKey=\"value\"\r\n                                        >\r\n                                            {(metrics?.methodData || []).map((entry, index) => (\r\n                                                <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} stroke=\"none\" />\r\n                                            ))}\r\n                                        </Pie>\r\n                                        <Tooltip\r\n                                            contentStyle={{ backgroundColor: '#18181b', border: '1px solid #27272a', borderRadius: '8px' }}\r\n                                            itemStyle={{ color: '#fff' }}\r\n                                        />\r\n                                    </PieChart>\r\n                                </ResponsiveContainer>\r\n                                {/* Center Text Overlay */}\r\n                                <div className=\"absolute inset-0 flex flex-col items-center justify-center pointer-events-none\">\r\n                                    <span className=\"text-3xl font-bold text-white\">{metrics?.totalRefunds || 0}</span>\r\n                                    <span className=\"text-xs text-zinc-500 uppercase tracking-widest\">Total</span>\r\n                                </div>\r\n                            </div>\r\n                            {/* Legend */}\r\n                            <div className=\"flex flex-wrap gap-3 justify-center pb-4\">\r\n                                {(metrics?.methodData || []).map((entry, index) => (\r\n                                    <div key={entry.name} className=\"flex items-center gap-1.5 text-xs text-zinc-400\">\r\n                                        <div className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: COLORS[index % COLORS.length] }}></div>\r\n                                        {entry.name}\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* 4. FAILURES SECTION */}\r\n                    <div className=\"bg-zinc-900/50 border border-zinc-800 rounded-xl overflow-hidden\">\r\n                        <div className=\"p-6 border-b border-zinc-800 flex justify-between items-center\">\r\n                            <div>\r\n                                <h3 className=\"text-lg font-semibold text-white\">Failure Analysis</h3>\r\n                                <p className=\"text-sm text-zinc-500\">Actionable insights on rejected refunds</p>\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                                <div className=\"text-sm text-zinc-500\">Total Stuck Amount</div>\r\n                                <div className=\"text-xl font-bold text-red-500\">‚Çπ{metrics?.stuckAmount?.toLocaleString() || 0}</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-0 divide-y lg:divide-y-0 lg:divide-x divide-zinc-800\">\r\n                            {/* Left: Chart */}\r\n                            <div className=\"p-6 h-[250px]\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <BarChart layout=\"vertical\" data={metrics?.failureReasonDistribution || []} margin={{ left: 10, right: 10 }}>\r\n                                        <XAxis type=\"number\" hide />\r\n                                        <YAxis dataKey=\"name\" type=\"category\" width={100} tick={{ fill: '#a1a1aa', fontSize: 11 }} axisLine={false} tickLine={false} />\r\n                                        <Tooltip cursor={{ fill: '#27272a' }} contentStyle={{ backgroundColor: '#18181b', border: '1px solid #27272a' }} />\r\n                                        <Bar dataKey=\"value\" fill=\"#ef4444\" radius={[0, 4, 4, 0]} barSize={20} />\r\n                                    </BarChart>\r\n                                </ResponsiveContainer>\r\n                            </div>\r\n\r\n                            {/* Right: List */}\r\n                            <div className=\"p-6 max-h-[250px] overflow-y-auto space-y-3 custom-scrollbar\">\r\n                                <p className=\"text-sm text-zinc-500 mb-2\">Recent Rejections:</p>\r\n                                {(!metrics?.recentFailures || metrics.recentFailures.length === 0) ? (\r\n                                    <div className=\"flex flex-col items-center justify-center py-8 text-zinc-500 space-y-2\">\r\n                                        <CheckCircle2 size={32} className=\"text-emerald-500/50\" />\r\n                                        <p className=\"text-sm\">No recent failures.</p>\r\n                                    </div>\r\n                                ) : (\r\n                                    metrics.recentFailures.map((fail) => (\r\n                                        <div key={fail.id} className=\"group flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/5 hover:border-red-500/30 hover:bg-red-500/5 transition-all\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className=\"w-8 h-8 rounded-full bg-red-500/10 flex items-center justify-center text-red-500 shrink-0\">\r\n                                                    {(fail.failureReason || 'unknown').toLowerCase().includes('bank') ? <WifiOff size={14} /> :\r\n                                                        (fail.failureReason || 'unknown').toLowerCase().includes('user') ? <UserX size={14} /> :\r\n                                                            <AlertTriangle size={14} />}\r\n                                                </div>\r\n                                                <div className=\"min-w-0\">\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <p className=\"text-sm text-gray-200 font-medium truncate\">#{fail.orderId}</p>\r\n                                                        <span className=\"text-[10px] text-red-400 bg-red-500/10 px-1.5 rounded truncate max-w-[120px]\">\r\n                                                            {fail.failureReason}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                    <p className=\"text-xs text-gray-500 font-mono mt-0.5\">‚Çπ{fail.amount}</p>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <a\r\n                                                href={`/t/${fail.id}`}\r\n                                                className=\"w-8 h-8 flex items-center justify-center rounded-lg bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white transition-colors\"\r\n                                            >\r\n                                                <ArrowUpRight size={16} />\r\n                                            </a>\r\n                                        </div>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* 5. MODALS */}\r\n                    <>\r\n                        <CreateRefundModal isOpen={isCreateModalOpen} onClose={() => setIsCreateModalOpen(false)} onSuccess={() => window.location.reload()} />\r\n                        <BulkImportModal isOpen={isImportModalOpen} onClose={() => setIsImportModalOpen(false)} onSuccess={() => window.location.reload()} />\r\n                        <BulkUpdateModal isOpen={isUpdateModalOpen} onClose={() => setIsUpdateModalOpen(false)} onSuccess={() => window.location.reload()} />\r\n                        <RefundMethodModal isOpen={isMethodModalOpen} onClose={() => setIsMethodModalOpen(false)} onSelect={handleMethodSelect} />\r\n                    </>\r\n\r\n                </div>\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\dashboard\\reports\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_dateRange' is assigned a value but never used.","line":20,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setDateRange' is assigned a value but never used.","line":20,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from \"react\";\r\nimport { collection, query, where, getDocs, orderBy, limit, addDoc, doc, getDoc } from \"firebase/firestore\";\r\nimport { db } from \"@/lib/firebase\";\r\nimport { useAuth } from \"@/lib/AuthContext\";\r\nimport Sidebar from \"@/components/dashboard/Sidebar\";\r\nimport Card from \"@/components/ui/Card\";\r\nimport Button from \"@/components/ui/Button\";\r\nimport Papa from \"papaparse\";\r\nimport { FileDown, History, Loader2 } from \"lucide-react\";\r\n\r\nexport default function ReportsPage() {\r\n    const { user } = useAuth();\r\n    const [loading, setLoading] = useState(true);\r\n    const [generating, setGenerating] = useState(false);\r\n\r\n    // Filters\r\n    const [scope, setScope] = useState(\"ALL\"); // ALL, ACTIVE, BREACH, SETTLED, FAILED\r\n    const [_dateRange, setDateRange] = useState('30d');\r\n    const [timeRange, setTimeRange] = useState(\"30\"); // 7, 30, 365, CUSTOM\r\n    const [customStart, setCustomStart] = useState(\"\");\r\n    const [customEnd, setCustomEnd] = useState(\"\");\r\n\r\n    // History Data\r\n    const [history, setHistory] = useState<unknown[]>([]);\r\n    const [metrics, setMetrics] = useState<Record<string, unknown> | null>(null);\r\n\r\n    const fetchMetrics = useCallback(async () => {\r\n        if (!user) return;\r\n        try {\r\n            const mRef = doc(db, \"merchants\", user.uid, \"metadata\", \"metrics\");\r\n            const mSnap = await getDoc(mRef);\r\n            if (mSnap.exists()) setMetrics(mSnap.data());\r\n        } catch (err) {\r\n            console.error(\"Failed to fetch metrics\", err);\r\n        }\r\n    }, [user]);\r\n\r\n    const fetchHistory = useCallback(async () => {\r\n        if (!user) return;\r\n        try {\r\n            const q = query(\r\n                collection(db, \"export_logs\"),\r\n                where(\"merchantId\", \"==\", user.uid),\r\n                orderBy(\"date\", \"desc\"),\r\n                limit(10)\r\n            );\r\n            const snapshot = await getDocs(q);\r\n            setHistory(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));\r\n        } catch (err) {\r\n            console.error(\"Failed to fetch history\", err);\r\n        }\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n            fetchHistory();\r\n            fetchMetrics();\r\n            setLoading(false);\r\n        }\r\n    }, [user, fetchHistory, fetchMetrics]);\r\n\r\n    const handleGenerate = async () => {\r\n        if (!user) return;\r\n        setGenerating(true);\r\n\r\n        try {\r\n            // 1. Calculate Date Range\r\n            let startDate = new Date();\r\n            let endDate = new Date(); // Now\r\n\r\n            if (timeRange === \"CUSTOM\") {\r\n                if (!customStart || !customEnd) {\r\n                    alert(\"Please select start and end dates.\");\r\n                    setGenerating(false);\r\n                    return;\r\n                }\r\n                startDate = new Date(customStart);\r\n                endDate = new Date(customEnd);\r\n                endDate.setHours(23, 59, 59, 999); // End of day\r\n            } else {\r\n                const days = parseInt(timeRange);\r\n                startDate.setDate(endDate.getDate() - days);\r\n            }\r\n\r\n            // 2. Build Query\r\n            // Note: Firestore requires composite index for 'merchantId + createdAt' mostly.\r\n            // We fetch somewhat broadly and filter in memory if needed for complex status logic to avoid index hell.\r\n            const q = query(\r\n                collection(db, \"refunds\"),\r\n                where(\"merchantId\", \"==\", user.uid),\r\n                where(\"createdAt\", \">=\", startDate),\r\n                where(\"createdAt\", \"<=\", endDate)\r\n            );\r\n\r\n            // 3. Execute Fetch\r\n            const snapshot = await getDocs(q);\r\n            let refunds = snapshot.docs.map(doc => doc.data());\r\n\r\n            // 4. Apply Status/Scope Filters (Client Side for flexibility)\r\n            if (scope !== \"ALL\") {\r\n                refunds = refunds.filter(r => {\r\n                    const status = r.status || \"\";\r\n                    if (scope === \"ACTIVE\") return !status.includes(\"SETTLED\") && !status.includes(\"FAILED\");\r\n                    if (scope === \"SETTLED\") return status.includes(\"SETTLED\");\r\n                    if (scope === \"FAILED\") return status.includes(\"FAILED\") || status.includes(\"REJECTED\");\r\n                    if (scope === \"BREACH\") {\r\n                        // Logic: Active AND Passed SLA\r\n                        const isActive = !status.includes(\"SETTLED\") && !status.includes(\"FAILED\");\r\n                        const isBreached = r.slaDueDate && new Date() > new Date(r.slaDueDate);\r\n                        return isActive && isBreached;\r\n                    }\r\n                    return true;\r\n                });\r\n            }\r\n\r\n            if (refunds.length === 0) {\r\n                alert(\"No records found for the selected criteria.\");\r\n                setGenerating(false);\r\n                return;\r\n            }\r\n\r\n            // 5. Generate CSV\r\n            // 5. Generate CSV (Lifecycle Log Format)\r\n            const csvData = refunds.map(r => {\r\n                // Helper to find date for a specific status in the timeline\r\n                const findDate = (statusKey: string) => {\r\n                    const entry = (r.timeline as Array<{ status?: string; date?: string | number | Date }>)?.find((t) => t.status?.includes(statusKey));\r\n                    return entry?.date ? new Date(entry.date).toLocaleDateString() : \"\";\r\n                };\r\n\r\n                return {\r\n                    \"Order ID\": r.orderId,\r\n                    \"Amount\": r.amount,\r\n                    \"Customer Name\": r.customerName,\r\n                    \"Customer Email\": r.customerEmail,\r\n                    \"Current Status\": r.status,\r\n\r\n                    // --- Lifecycle Dates ---\r\n                    \"Data Requested On\": findDate('GATHERING_DATA'),\r\n                    \"Refund Initiated On\": findDate('REFUND_INITIATED') || findDate('CREATED'), // Handle legacy CREATED\r\n                    \"Processing Started On\": findDate('PROCESSING'),\r\n                    \"Settled On\": findDate('SETTLED'),\r\n                    \"Failed On\": findDate('FAILED'),\r\n\r\n                    // --- Details ---\r\n                    \"Payment Method\": r.paymentMethod || \"UPI\",\r\n                    \"UTR / Ref\": r.proofs?.utr || r.proofs?.arn || \"\",\r\n                    \"Failure Reason\": r.failureReason || \"\"\r\n                };\r\n            });\r\n\r\n            const csvString = Papa.unparse(csvData);\r\n            const blob = new Blob([csvString], { type: \"text/csv;charset=utf-8;\" });\r\n            const url = URL.createObjectURL(blob);\r\n\r\n            // Trigger Download\r\n            const link = document.createElement(\"a\");\r\n            link.href = url;\r\n            link.download = `refunds_export_${scope}_${new Date().toISOString().split('T')[0]}.csv`;\r\n            document.body.appendChild(link);\r\n            link.click();\r\n            document.body.removeChild(link);\r\n\r\n            // 6. Log Action\r\n            await addDoc(collection(db, \"export_logs\"), {\r\n                merchantId: user.uid,\r\n                date: new Date().toISOString(),\r\n                type: scope,\r\n                range: timeRange === \"CUSTOM\" ? \"Custom\" : `${timeRange} Days`,\r\n                count: refunds.length,\r\n                adminEmail: user.email\r\n            });\r\n\r\n            // Refresh History\r\n            fetchHistory();\r\n\r\n        } catch (error) {\r\n            console.error(\"Export failed\", error);\r\n            alert(\"Export failed. Check console.\");\r\n        } finally {\r\n            setGenerating(false);\r\n        }\r\n    };\r\n\r\n    if (loading) return <div className=\"min-h-screen bg-[#050505] flex items-center justify-center text-white\">Loading...</div>;\r\n\r\n    return (\r\n        <div className=\"flex min-h-screen bg-[#050505]\">\r\n            <Sidebar />\r\n\r\n            <main className=\"flex-1 ml-[64px] md:ml-[240px] p-8 text-white\">\r\n                <div className=\"max-w-5xl mx-auto space-y-8\">\r\n\r\n                    {/* Header */}\r\n                    <div>\r\n                        <h1 className=\"text-2xl font-bold tracking-tight\">Data & Reports</h1>\r\n                        <p className=\"text-gray-500 text-sm\">Export your refund data for accounting and reconciliation.</p>\r\n                    </div>\r\n\r\n                    {/* Summary Metrics (Synced with Scoreboard) */}\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                        <div className=\"bg-[#0A0A0A] border border-white/5 p-4 rounded-xl\">\r\n                            <p className=\"text-[10px] text-gray-500 uppercase tracking-widest font-bold mb-1 font-mono\">Total Settled</p>\r\n                            <p className=\"text-2xl font-bold font-mono\">‚Çπ{(metrics?.totalSettledAmount as number)?.toLocaleString('en-IN') || 0}</p>\r\n                        </div>\r\n                        <div className=\"bg-[#0A0A0A] border border-white/5 p-4 rounded-xl\">\r\n                            <p className=\"text-[10px] text-gray-500 uppercase tracking-widest font-bold mb-1 font-mono\">Active Liability</p>\r\n                            <p className=\"text-2xl font-bold font-mono text-orange-400\">‚Çπ{(metrics?.activeLiability as number)?.toLocaleString('en-IN') || 0}</p>\r\n                        </div>\r\n                        <div className=\"bg-[#0A0A0A] border border-white/5 p-4 rounded-xl\">\r\n                            <p className=\"text-[10px] text-gray-500 uppercase tracking-widest font-bold mb-1 font-mono\">Total Refunds</p>\r\n                            <p className=\"text-2xl font-bold font-mono text-blue-400\">{metrics?.totalRefunds as React.ReactNode || 0}</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n\r\n                        {/* LEFT: Export Controller */}\r\n                        <div className=\"md:col-span-2\">\r\n                            <Card className=\"bg-[#0A0A0A] border-white/10 p-6 h-full\">\r\n                                <div className=\"flex items-center gap-2 mb-6 text-gray-200\">\r\n                                    <FileDown className=\"text-blue-500\" />\r\n                                    <h2 className=\"font-semibold\">New Export</h2>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-6\">\r\n\r\n                                    {/* Scope Selection */}\r\n                                    <div>\r\n                                        <label className=\"block text-xs font-medium text-gray-500 mb-2 uppercase tracking-wider\">Report Scope</label>\r\n                                        <div className=\"flex flex-wrap gap-2\">\r\n                                            {[\"ALL\", \"ACTIVE\", \"SETTLED\", \"FAILED\", \"BREACH\"].map((opt) => (\r\n                                                <button\r\n                                                    key={opt}\r\n                                                    onClick={() => setScope(opt)}\r\n                                                    className={`px-4 py-2 rounded-lg text-sm font-medium border transition-all ${scope === opt\r\n                                                        ? \"bg-blue-600 border-blue-600 text-white\"\r\n                                                        : \"bg-white/5 border-white/10 text-gray-400 hover:bg-white/10\"\r\n                                                        }`}\r\n                                                >\r\n                                                    {opt === \"ALL\" ? \"All Refunds\" :\r\n                                                        opt === \"ACTIVE\" ? \"Active / Pending\" :\r\n                                                            opt === \"BREACH\" ? \"SLA Breaches\" :\r\n                                                                opt.charAt(0) + opt.slice(1).toLowerCase()}\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Date Selection */}\r\n                                    <div>\r\n                                        <label className=\"block text-xs font-medium text-gray-500 mb-2 uppercase tracking-wider\">Date Range</label>\r\n                                        <select\r\n                                            value={timeRange}\r\n                                            onChange={(e) => setTimeRange(e.target.value)}\r\n                                            className=\"w-full md:w-1/2 p-3 bg-black border border-white/10 rounded-lg text-white text-sm focus:border-blue-500 outline-none mb-3\"\r\n                                        >\r\n                                            <option value=\"7\">Last 7 Days</option>\r\n                                            <option value=\"30\">Last 30 Days</option>\r\n                                            <option value=\"90\">Last 3 Months</option>\r\n                                            <option value=\"365\">Last 1 Year</option>\r\n                                            <option value=\"CUSTOM\">Custom Range</option>\r\n                                        </select>\r\n\r\n                                        {timeRange === \"CUSTOM\" && (\r\n                                            <div className=\"flex gap-3 animate-in fade-in slide-in-from-top-2\">\r\n                                                <div className=\"flex-1\">\r\n                                                    <label className=\"text-xs text-gray-500 mb-1 block\">From</label>\r\n                                                    <input\r\n                                                        type=\"date\"\r\n                                                        value={customStart}\r\n                                                        onChange={(e) => setCustomStart(e.target.value)}\r\n                                                        className=\"w-full p-2 bg-black border border-white/10 rounded-lg text-white text-sm\"\r\n                                                    />\r\n                                                </div>\r\n                                                <div className=\"flex-1\">\r\n                                                    <label className=\"text-xs text-gray-500 mb-1 block\">To</label>\r\n                                                    <input\r\n                                                        type=\"date\"\r\n                                                        value={customEnd}\r\n                                                        onChange={(e) => setCustomEnd(e.target.value)}\r\n                                                        className=\"w-full p-2 bg-black border border-white/10 rounded-lg text-white text-sm\"\r\n                                                    />\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    <div className=\"pt-4 border-t border-white/5\">\r\n                                        <Button\r\n                                            onClick={handleGenerate}\r\n                                            disabled={generating}\r\n                                            className=\"w-full flex items-center justify-center gap-2 py-3 text-base\"\r\n                                        >\r\n                                            {generating ? (\r\n                                                <>\r\n                                                    <Loader2 className=\"animate-spin\" /> Generating...\r\n                                                </>\r\n                                            ) : (\r\n                                                <>Generate CSV Export</>\r\n                                            )}\r\n                                        </Button>\r\n                                        <p className=\"text-xs text-center text-gray-600 mt-2\">\r\n                                            Includes all fields: Order ID, Amount, Customer, Status, UTR.\r\n                                        </p>\r\n                                    </div>\r\n\r\n                                </div>\r\n                            </Card>\r\n                        </div>\r\n\r\n                        {/* RIGHT: History */}\r\n                        <div className=\"md:col-span-1\">\r\n                            <Card className=\"bg-[#0A0A0A] border-white/10 p-6 h-full flex flex-col\">\r\n                                <div className=\"flex items-center gap-2 mb-4 text-gray-200\">\r\n                                    <History className=\"text-gray-400\" />\r\n                                    <h2 className=\"font-semibold text-sm\">Recent Exports</h2>\r\n                                </div>\r\n\r\n                                <div className=\"flex-1 overflow-y-auto min-h-[300px]\">\r\n                                    {history.length === 0 ? (\r\n                                        <div className=\"text-center text-gray-600 py-10 text-sm\">\r\n                                            No export history found.\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div className=\"space-y-3\">\r\n                                            {history.map((item) => {\r\n                                                const log = item as { id: string; type: string; date: string; count: number; range: string };\r\n                                                return (\r\n                                                    <div key={log.id} className=\"p-3 bg-white/5 rounded-lg border border-white/5 hover:border-white/10 transition-colors\">\r\n                                                        <div className=\"flex justify-between items-start mb-1\">\r\n                                                            <span className=\"text-xs font-bold text-white bg-blue-500/20 text-blue-300 px-1.5 py-0.5 rounded\">\r\n                                                                {log.type}\r\n                                                            </span>\r\n                                                            <span className=\"text-[10px] text-gray-500\">\r\n                                                                {new Date(log.date).toLocaleDateString()}\r\n                                                            </span>\r\n                                                        </div>\r\n                                                        <p className=\"text-xs text-gray-400 mt-2\">\r\n                                                            Exported <span className=\"text-white font-mono\">{log.count}</span> records\r\n                                                        </p>\r\n                                                        <p className=\"text-[10px] text-gray-600 mt-1\">\r\n                                                            Range: {log.range}\r\n                                                        </p>\r\n                                                    </div>\r\n                                                );\r\n                                            })}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </Card>\r\n                        </div>\r\n\r\n                    </div>\r\n                </div>\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\dashboard\\search\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\dashboard\\settings\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\dashboard\\settled\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\onboarding\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\pay\\[id]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\pay\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\signup\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\t\\[id]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\app\\t\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\concierge\\ChatWindow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\concierge\\ConciergeAvatar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MessageSquare' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { motion } from \"framer-motion\";\r\nimport { MessageSquare, X } from \"lucide-react\";\r\nimport { useState, useEffect } from \"react\";\r\n\r\ninterface ConciergeAvatarProps {\r\n    isOpen: boolean;\r\n    onClick: () => void;\r\n    isIdle: boolean; // Triggers the \"Peek\" animation\r\n}\r\n\r\nexport default function ConciergeAvatar({ isOpen, onClick, isIdle }: ConciergeAvatarProps) {\r\n    const [isBlinking, setIsBlinking] = useState(false);\r\n\r\n    // Random Blink Animation\r\n    useEffect(() => {\r\n        const blinkInterval = setInterval(() => {\r\n            setIsBlinking(true);\r\n            setTimeout(() => setIsBlinking(false), 200);\r\n        }, 4000); // Blink every 4s\r\n        return () => clearInterval(blinkInterval);\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"fixed bottom-6 right-6 z-50 flex flex-col items-end gap-2\">\r\n\r\n            {/* Intelligent Nudge (Frosted Glass) */}\r\n            {!isOpen && isIdle && (\r\n                <motion.div\r\n                    initial={{ opacity: 0, x: 20, scale: 0.95 }}\r\n                    animate={{ opacity: 1, x: 0, scale: 1 }}\r\n                    exit={{ opacity: 0, x: 10, scale: 0.95 }}\r\n                    className=\"bg-white/10 backdrop-blur-md border border-white/10 text-white px-4 py-3 rounded-2xl rounded-br-none shadow-2xl text-xs font-medium max-w-[200px] mb-2 cursor-pointer\"\r\n                    onClick={onClick}\r\n                >\r\n                    <div className=\"flex gap-2 items-center\">\r\n                        <span className=\"w-1.5 h-1.5 bg-blue-400 rounded-full animate-pulse\" />\r\n                        Bot Ryyt\r\n                    </div>\r\n                    <p className=\"mt-1 text-gray-300\">I noticed you&apos;re browsing. Need a quick tour?</p>\r\n                </motion.div>\r\n            )}\r\n\r\n            {/* The Avatar Button (Premium Glass Smiley) */}\r\n            <motion.button\r\n                initial={{ scale: 0, opacity: 0 }}\r\n                animate={{\r\n                    scale: 1,\r\n                    opacity: 1,\r\n                    y: [0, -6, 0] // Floating\r\n                }}\r\n                transition={{\r\n                    y: { duration: 3.5, repeat: Infinity, ease: \"easeInOut\" },\r\n                    scale: { duration: 0.5 }\r\n                }}\r\n                whileHover={{ scale: 1.1 }}\r\n                whileTap={{ scale: 0.95 }}\r\n                onClick={onClick}\r\n                className={`relative w-16 h-16 rounded-full shadow-2xl flex items-center justify-center transition-all duration-300 backdrop-blur-md ${isOpen\r\n                    ? \"bg-[#0A0A0A] border border-white/20 text-white\"\r\n                    : \"bg-gradient-to-tr from-blue-600/90 to-blue-500/90 border border-white/20 text-white\"\r\n                    }`}\r\n            >\r\n                {isOpen ? (\r\n                    <X size={24} />\r\n                ) : (\r\n                    <div className=\"relative\">\r\n                        {/* Abstract Face / Logo Mark */}\r\n                        <div className=\"w-8 h-8 relative\">\r\n                            {/* Eyes */}\r\n                            <motion.div\r\n                                className=\"absolute top-2 left-1 w-1.5 h-1.5 bg-white rounded-full shadow-[0_0_5px_white]\"\r\n                                animate={{ scaleY: isBlinking ? 0.1 : 1 }}\r\n                            />\r\n                            <motion.div\r\n                                className=\"absolute top-2 right-1 w-1.5 h-1.5 bg-white rounded-full shadow-[0_0_5px_white]\"\r\n                                animate={{ scaleY: isBlinking ? 0.1 : 1 }}\r\n                            />\r\n                            {/* Smile */}\r\n                            <div className=\"absolute bottom-2 left-1.5 w-5 h-2 border-b-2 border-white rounded-full shadow-[0_1px_2px_rgba(0,0,0,0.1)]\" />\r\n                        </div>\r\n\r\n                        {/* Glossy Reflection (Glass Effect) */}\r\n                        <div className=\"absolute -top-3 -left-3 w-6 h-6 bg-white/20 rounded-full blur-[2px]\" />\r\n                    </div>\r\n                )}\r\n\r\n                {/* Pulse Ring */}\r\n                {!isOpen && (\r\n                    <span className=\"absolute inset-0 rounded-full border border-blue-400 opacity-0 animate-ping\" />\r\n                )}\r\n            </motion.button>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\concierge\\GlobalConcierge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\dashboard\\BulkActionBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\dashboard\\BulkImportModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isParsing' is assigned a value but never used.","line":60,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":60,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport Papa from \"papaparse\";\r\nimport { collection, addDoc, Timestamp, query, where, getDocs } from \"firebase/firestore\";\r\nimport { db } from \"@/lib/firebase\";\r\nimport { useAuth } from \"@/lib/AuthContext\";\r\nimport { isFeatureEnabled } from \"@/config/features\";\r\nimport { updateScoreboard } from \"@/lib/metrics\";\r\nimport { sendUpdate, NotificationRefundData } from \"@/lib/notificationService\";\r\nimport Card from \"@/components/ui/Card\";\r\nimport Button from \"@/components/ui/Button\";\r\nimport { X, Upload, FileSpreadsheet, CheckCircle2, AlertTriangle, Play, Download } from \"lucide-react\";\r\n\r\ninterface BulkImportModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onSuccess: () => void;\r\n}\r\n\r\nconst SLA_DAYS: Record<string, number> = {\r\n    UPI: 2,\r\n    WALLET: 2,\r\n    NETBANKING: 7,\r\n    DEBIT_CARD: 7,\r\n    CREDIT_CARD: 7,\r\n    COD: 5,\r\n};\r\n\r\nconst normalizePaymentMethod = (input: string): string => {\r\n    if (!input) return 'UPI'; // Default fallback\r\n\r\n    // 1. Clean the string: Uppercase, Trim spaces\r\n    const clean = input.toString().toUpperCase().trim();\r\n\r\n    // 2. Map known variations to the Internal Enum\r\n    if (clean.includes('DEBIT')) return 'DEBIT_CARD';\r\n    if (clean.includes('CREDIT')) return 'CREDIT_CARD';\r\n    if (clean.includes('NET')) return 'NETBANKING';\r\n    if (clean.includes('COD') || clean.includes('CASH')) return 'COD';\r\n    if (clean.includes('WALLET')) return 'WALLET';\r\n\r\n    // 3. Default for standard codes like 'UPI'\r\n    return clean.replace(/\\s+/g, '_');\r\n};\r\n\r\ninterface BulkImportItem {\r\n    original: Record<string, string>;\r\n    isValid: boolean;\r\n    status: string;\r\n    paymentMethod: string;\r\n    amount: number;\r\n}\r\n\r\nexport default function BulkImportModal({ isOpen, onClose, onSuccess }: BulkImportModalProps) {\r\n    const { user } = useAuth();\r\n    const [file, setFile] = useState<File | null>(null);\r\n    const [parsedData, setParsedData] = useState<BulkImportItem[]>([]);\r\n    const [validationSummary, setValidationSummary] = useState({ valid: 0, invalid: 0, total: 0 });\r\n    const [isParsing, setIsParsing] = useState(false);\r\n    const [isUploading, setIsUploading] = useState(false);\r\n    const [uploadProgress, setUploadProgress] = useState(0);\r\n    const [resultLog, setResultLog] = useState<{ success: number; errors: string[] } | null>(null);\r\n\r\n    if (!isOpen) return null;\r\n\r\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const selectedFile = e.target.files?.[0];\r\n        if (selectedFile) {\r\n            setFile(selectedFile);\r\n            parseCSV(selectedFile);\r\n        }\r\n    };\r\n\r\n    const parseCSV = (file: File) => {\r\n        setIsParsing(true);\r\n        Papa.parse(file, {\r\n            header: true,\r\n            skipEmptyLines: true,\r\n            complete: (results) => {\r\n                const rows = results.data as Record<string, string>[];\r\n                validateRows(rows);\r\n                setIsParsing(false);\r\n            },\r\n            error: (err) => {\r\n                console.error(\"CSV Parse Error:\", err);\r\n                setIsParsing(false);\r\n                alert(\"Failed to read CSV file.\");\r\n            }\r\n        });\r\n    };\r\n\r\n    const validateRows = (rows: Record<string, string>[]) => {\r\n        let validCount = 0;\r\n        let invalidCount = 0;\r\n        const processed: BulkImportItem[] = rows.map((row) => {\r\n            // Validation Logic\r\n            const hasRequired = row['Order ID'] && row['Amount'] && row['Customer Name'] && row['Customer Email'];\r\n\r\n            // Basic Status Logic (Same as CreateRefundModal)\r\n            const paymentMethod = normalizePaymentMethod(row['Payment Method']);\r\n            const isCOD = paymentMethod === 'COD';\r\n            const targetUpi = (row['UPI ID'] || '').toString().trim();\r\n\r\n            // Logic: \r\n            // 1. If we have a UPI ID (even if not strictly required by method) -> CREATED\r\n            // 2. If COD and NO UPI -> GATHERING_DATA (Need to ask customer)\r\n            // 3. Else (Card/Netbanking) -> CREATED\r\n            let status = 'CREATED';\r\n            if (targetUpi.length > 0) {\r\n                status = 'CREATED';\r\n            } else if (isCOD && targetUpi.length === 0) {\r\n                status = 'GATHERING_DATA';\r\n            }\r\n\r\n            const isValid = !!hasRequired;\r\n            if (isValid) validCount++; else invalidCount++;\r\n\r\n            return {\r\n                original: row,\r\n                isValid,\r\n                status,\r\n                paymentMethod, // Normalized\r\n                amount: Number(row['Amount']) || 0\r\n            };\r\n        });\r\n\r\n        setParsedData(processed);\r\n        setValidationSummary({ valid: validCount, invalid: invalidCount, total: rows.length });\r\n    };\r\n\r\n    const handleUpload = async () => {\r\n        if (!user || validationSummary.valid === 0) return;\r\n\r\n        setIsUploading(true);\r\n        setUploadProgress(0);\r\n        const validRows = parsedData.filter(r => r.isValid);\r\n        let completed = 0;\r\n        let successCount = 0;\r\n        const currentErrors: string[] = [];\r\n\r\n        try {\r\n            // Process sequentially to handle async queries reliably\r\n            for (let i = 0; i < validRows.length; i++) {\r\n                const item = validRows[i];\r\n                const row = item.original;\r\n\r\n                try {\r\n                    // Check for Duplicates\r\n                    const q = query(\r\n                        collection(db, \"refunds\"),\r\n                        where(\"merchantId\", \"==\", user.uid),\r\n                        where(\"orderId\", \"==\", row['Order ID'])\r\n                    );\r\n                    const snapshot = await getDocs(q);\r\n\r\n                    if (!snapshot.empty) {\r\n                        currentErrors.push(`Row ${i + 1}: Order ${row['Order ID']} skipped (Already Exists)`);\r\n                        continue; // Skip\r\n                    }\r\n\r\n                    const daysToAdd = SLA_DAYS[item.paymentMethod] || 7;\r\n                    const now = new Date();\r\n                    const refundDate = new Date();\r\n\r\n                    // Calculate SLA\r\n                    const dueDate = new Date(refundDate);\r\n                    dueDate.setDate(dueDate.getDate() + daysToAdd);\r\n\r\n                    const timelineTitle = item.status === 'GATHERING_DATA'\r\n                        ? \"Refund Drafted - Waiting for Details\"\r\n                        : \"Refund Initiated\";\r\n\r\n                    const docRef = await addDoc(collection(db, \"refunds\"), {\r\n                        merchantId: user.uid,\r\n                        orderId: row['Order ID'],\r\n                        customerName: row['Customer Name'],\r\n                        customerEmail: row['Customer Email'],\r\n                        amount: item.amount,\r\n                        paymentMethod: item.paymentMethod,\r\n                        status: item.status,\r\n                        targetUpi: row['UPI ID'] || null,\r\n                        createdAt: Timestamp.fromDate(now),\r\n                        slaDueDate: dueDate.toISOString(),\r\n                        timeline: [\r\n                            {\r\n                                status: item.status,\r\n                                title: timelineTitle,\r\n                                date: now.toISOString(),\r\n                                note: \"Bulk Imported via CSV\"\r\n                            }\r\n                        ]\r\n                    });\r\n\r\n                    // --- SCOREBOARD AGGREGATION (Conditional) ---\r\n                    if (isFeatureEnabled(\"ENABLE_SCOREBOARD_AGGREGATION\")) {\r\n                        updateScoreboard(user.uid, \"NEW_REFUND\", item.amount);\r\n                    }\r\n                    // ---------------------------------------------\r\n\r\n                    // --- EMAIL TRIGGER (Bulk via branded service) ---\r\n                    await sendUpdate(user.uid, { id: docRef.id, ...row, amount: item.amount, customerEmail: row['Customer Email'], orderId: row['Order ID'], paymentMethod: item.paymentMethod } as NotificationRefundData, item.status);\r\n                    // -----------------------------\r\n                    successCount++;\r\n                } catch (rowErr) {\r\n                    console.error(\"Row Error\", rowErr);\r\n                    currentErrors.push(`Row ${i + 1}: Order ${row['Order ID']} failed to create.`);\r\n                } finally {\r\n                    completed++;\r\n                    setUploadProgress(Math.round((completed / validRows.length) * 100));\r\n                }\r\n            }\r\n\r\n            setResultLog({ success: successCount, errors: currentErrors });\r\n            onSuccess();\r\n            // Do not auto-close\r\n\r\n        } catch (error) {\r\n            console.error(\"Bulk Import Critical Error:\", error);\r\n            alert(\"Critical System Error during import.\");\r\n        } finally {\r\n            setIsUploading(false);\r\n        }\r\n    };\r\n\r\n    const handleDownloadTemplate = () => {\r\n        const headers = [\"Order ID\", \"Amount\", \"Customer Name\", \"Customer Email\", \"Payment Method\", \"UPI ID\"];\r\n        const sampleRow = [\"#SAMPLE-123\", \"1500\", \"John Doe\", \"john@example.com\", \"UPI\", \"john@okicici\"];\r\n\r\n        const csvContent = [\r\n            headers.join(\",\"),\r\n            sampleRow.join(\",\")\r\n        ].join(\"\\n\");\r\n\r\n        const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8;\" });\r\n        const url = URL.createObjectURL(blob);\r\n        const link = document.createElement(\"a\");\r\n        link.setAttribute(\"href\", url);\r\n        link.setAttribute(\"download\", \"refunds_import_template.csv\");\r\n        link.style.visibility = \"hidden\";\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm\">\r\n            <Card className=\"w-full max-w-lg relative bg-[#0A0A0A] border-white/10\">\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"absolute right-4 top-4 text-gray-400 hover:text-white transition-colors\"\r\n                >\r\n                    <X size={20} />\r\n                </button>\r\n\r\n                {!resultLog && (\r\n                    <div className=\"mb-6\">\r\n                        <h2 className=\"text-xl font-bold text-white flex items-center gap-2\">\r\n                            <FileSpreadsheet className=\"text-green-500\" />\r\n                            Bulk Import Refunds\r\n                        </h2>\r\n                        <p className=\"text-sm text-gray-400\">Upload a CSV file to process multiple refunds.</p>\r\n                    </div>\r\n                )}\r\n\r\n                {!file && !resultLog ? (\r\n                    <>\r\n                        <div className=\"border-2 border-dashed border-white/10 rounded-xl p-10 text-center hover:border-blue-500/30 transition-colors bg-white/5\">\r\n                            <Upload className=\"w-10 h-10 text-gray-500 mx-auto mb-4\" />\r\n                            <label className=\"block\">\r\n                                <span className=\"bg-blue-600 text-white px-4 py-2 rounded-lg cursor-pointer hover:bg-blue-500 transition-colors text-sm font-medium\">\r\n                                    Select CSV File\r\n                                </span>\r\n                                <input\r\n                                    type=\"file\"\r\n                                    accept=\".csv\"\r\n                                    className=\"hidden\"\r\n                                    onChange={handleFileChange}\r\n                                />\r\n                            </label>\r\n                            <p className=\"text-xs text-gray-500 mt-4\">\r\n                                Headers needed: Order ID, Amount, Customer Name, Customer Email, Payment Method\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-center mt-4\">\r\n                            <button\r\n                                onClick={handleDownloadTemplate}\r\n                                className=\"flex items-center gap-2 text-xs text-gray-400 hover:text-white transition-colors\"\r\n                            >\r\n                                <Download size={14} /> Download Sample CSV Template\r\n                            </button>\r\n                        </div>\r\n                    </>\r\n                ) : (\r\n                    <div className=\"space-y-6\">\r\n                        {/* Summary Stats */}\r\n                        <div className=\"grid grid-cols-3 gap-3 text-center\">\r\n                            <div className=\"p-3 bg-white/5 rounded-lg border border-white/10\">\r\n                                <p className=\"text-xs text-gray-400 uppercase\">Found</p>\r\n                                <p className=\"text-xl font-bold text-white\">{validationSummary.total}</p>\r\n                            </div>\r\n                            <div className=\"p-3 bg-green-500/10 rounded-lg border border-green-500/20\">\r\n                                <p className=\"text-xs text-green-400 uppercase\">Valid</p>\r\n                                <p className=\"text-xl font-bold text-green-400\">{validationSummary.valid}</p>\r\n                            </div>\r\n                            <div className=\"p-3 bg-red-500/10 rounded-lg border border-red-500/20\">\r\n                                <p className=\"text-xs text-red-400 uppercase\">Invalid</p>\r\n                                <p className=\"text-xl font-bold text-red-400\">{validationSummary.invalid}</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Progress Bar */}\r\n                        {isUploading && (\r\n                            <div className=\"w-full bg-white/10 rounded-full h-2 overflow-hidden\">\r\n                                <div\r\n                                    className=\"bg-green-500 h-full transition-all duration-300\"\r\n                                    style={{ width: `${uploadProgress}%` }}\r\n                                ></div>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"flex gap-3 pt-2\">\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                onClick={() => { setFile(null); setParsedData([]); }}\r\n                                disabled={isUploading}\r\n                                className=\"flex-1\"\r\n                            >\r\n                                Reset\r\n                            </Button>\r\n                            <Button\r\n                                onClick={handleUpload}\r\n                                disabled={isUploading || validationSummary.valid === 0}\r\n                                className=\"flex-1 flex items-center justify-center gap-2\"\r\n                            >\r\n                                {isUploading ? \"Importing...\" : (\r\n                                    <>\r\n                                        <Play size={16} fill=\"currentColor\" />\r\n                                        Process {validationSummary.valid} Refunds\r\n                                    </>\r\n                                )}\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {resultLog && (\r\n                    <div className=\"space-y-6\">\r\n                        <div className=\"text-center space-y-2\">\r\n                            <div className=\"inline-flex p-3 rounded-full bg-green-500/10 text-green-500 mb-2\">\r\n                                <CheckCircle2 size={32} />\r\n                            </div>\r\n                            <h3 className=\"text-xl font-bold text-white\">Import Complete</h3>\r\n                            <div className=\"flex justify-center gap-4 text-sm\">\r\n                                <span className=\"text-green-400 font-medium\">Success: {resultLog.success}</span>\r\n                                <span className={resultLog.errors.length > 0 ? \"text-red-400 font-medium\" : \"text-gray-500\"}>\r\n                                    Skipped/Errors: {resultLog.errors.length}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {resultLog.errors.length > 0 ? (\r\n                            <div className=\"bg-red-500/5 border border-red-500/20 rounded-lg p-4\">\r\n                                <h4 className=\"text-xs font-bold text-red-500 uppercase tracking-wider mb-2 flex items-center gap-2\">\r\n                                    <AlertTriangle size={12} />\r\n                                    Skipped / Error Log\r\n                                </h4>\r\n                                <div className=\"max-h-60 overflow-y-auto space-y-1 pr-2 custom-scrollbar\">\r\n                                    {resultLog.errors.map((err, i) => (\r\n                                        <div key={i} className=\"text-xs text-red-300 font-mono border-b border-red-500/10 last:border-0 pb-1 last:pb-0\">\r\n                                            {err}\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"p-4 bg-green-500/5 border border-green-500/10 rounded-lg text-center\">\r\n                                <p className=\"text-sm text-green-400\">All rows imported successfully!</p>\r\n                            </div>\r\n                        )}\r\n\r\n                        <Button onClick={onClose} className=\"w-full bg-white/10 hover:bg-white/20\">\r\n                            Close\r\n                        </Button>\r\n                    </div>\r\n                )}\r\n            </Card>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\dashboard\\BulkUpdateModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isParsing' is assigned a value but never used.","line":48,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'logs' is assigned a value but never used.","line":52,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport Papa from \"papaparse\";\r\nimport { collection, query, where, getDocs, doc, updateDoc, arrayUnion } from \"firebase/firestore\";\r\nimport { db } from \"@/lib/firebase\";\r\nimport { useAuth } from \"@/lib/AuthContext\";\r\nimport { isFeatureEnabled } from \"@/config/features\";\r\nimport { updateScoreboard } from \"@/lib/metrics\";\r\nimport { processSettlement } from \"@/lib/payoutService\";\r\nimport { sendUpdate, NotificationRefundData } from \"@/lib/notificationService\";\r\nimport Card from \"@/components/ui/Card\";\r\nimport Button from \"@/components/ui/Button\";\r\nimport { X, Upload, FileSignature, Play, Download, AlertTriangle, CheckCircle2 } from \"lucide-react\";\r\n\r\ninterface BulkUpdateModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onSuccess: () => void;\r\n}\r\n\r\nconst normalizeStatus = (input: string): string | null => {\r\n    if (!input) return null;\r\n    const clean = input.toString().toUpperCase().trim();\r\n\r\n    if (clean.includes('PROCESS') || clean.includes('PROGRESS')) return 'PROCESSING_AT_BANK';\r\n    if (clean.includes('SETTLED') || clean.includes('PAID') || clean.includes('DONE')) return 'SETTLED';\r\n    if (clean.includes('FAIL') || clean.includes('REJECT') || clean.includes('ERROR') || clean.includes('VOID')) return 'FAILED';\r\n    if (clean.includes('GATHER') || clean.includes('INCOMPLETE')) return 'GATHERING_DATA';\r\n\r\n    return null; // Unknown status\r\n};\r\n\r\ninterface BulkItem {\r\n    orderId: string;\r\n    status: string | null;\r\n    note: string;\r\n    isValid: boolean;\r\n    error: string;\r\n    raw: unknown;\r\n}\r\n\r\nexport default function BulkUpdateModal({ isOpen, onClose, onSuccess }: BulkUpdateModalProps) {\r\n    const { user } = useAuth();\r\n    const [file, setFile] = useState<File | null>(null);\r\n    const [parsedData, setParsedData] = useState<BulkItem[]>([]);\r\n    const [validationSummary, setValidationSummary] = useState({ valid: 0, invalid: 0, total: 0 });\r\n    const [isParsing, setIsParsing] = useState(false);\r\n    const [isUpdating, setIsUpdating] = useState(false);\r\n    const [progress, setProgress] = useState(0);\r\n    const [resultLog, setResultLog] = useState<{ success: number; errors: string[] } | null>(null);\r\n    const [logs, setLogs] = useState<string[]>([]); // internal processing logs\r\n\r\n    if (!isOpen) return null;\r\n\r\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const selectedFile = e.target.files?.[0];\r\n        if (selectedFile) {\r\n            setFile(selectedFile);\r\n            parseCSV(selectedFile);\r\n        }\r\n    };\r\n\r\n    const parseCSV = (file: File) => {\r\n        setIsParsing(true);\r\n        Papa.parse(file, {\r\n            header: true,\r\n            skipEmptyLines: true,\r\n            complete: (results) => {\r\n                const rows = results.data as unknown[];\r\n                validateRows(rows);\r\n                setIsParsing(false);\r\n            },\r\n            error: (err) => {\r\n                console.error(\"CSV Parse Error:\", err);\r\n                setIsParsing(false);\r\n                alert(\"Failed to read CSV.\");\r\n            }\r\n        });\r\n    };\r\n\r\n    const validateRows = (rows: unknown[]) => {\r\n        let validCount = 0;\r\n        let invalidCount = 0;\r\n\r\n        const processed: BulkItem[] = rows.map(r => {\r\n            const row = r as Record<string, unknown>;\r\n            const orderId = (row['orderId'] || row['Order ID'] || '').toString().trim();\r\n            const rawStatus = (row['newStatus'] || row['Status'] || '').toString().trim();\r\n            const status = normalizeStatus(rawStatus);\r\n            const note = (row['note'] || row['Note'] || \"\").toString().trim();\r\n\r\n            let isValid = !!orderId && !!status;\r\n            let error = \"\";\r\n\r\n            if (isValid && status === 'SETTLED' && !note) {\r\n                isValid = false;\r\n                error = \"UTR/Reference required for Settled status.\";\r\n            }\r\n\r\n            if (isValid && status === 'FAILED' && !note) {\r\n                isValid = false;\r\n                error = \"Failure Reason required for Failed status.\";\r\n            }\r\n\r\n            if (isValid) validCount++; else invalidCount++;\r\n\r\n            return {\r\n                orderId,\r\n                status,\r\n                note,\r\n                isValid,\r\n                error,\r\n                raw: row\r\n            };\r\n        });\r\n\r\n        setParsedData(processed);\r\n        setValidationSummary({ valid: validCount, invalid: invalidCount, total: rows.length });\r\n    };\r\n\r\n    const handleUpdate = async () => {\r\n        const validRows = parsedData.filter(r => r.isValid);\r\n        if (validRows.length === 0) return;\r\n        if (!user) return;\r\n\r\n        const userId = user.uid;\r\n        setIsUpdating(true);\r\n        setProgress(0);\r\n        setLogs([]);\r\n        let completed = 0;\r\n        let successCount = 0;\r\n        const newLogs: string[] = [];\r\n\r\n        try {\r\n            // Process sequentially or in small batches to respect rate limits and logic\r\n            // Using Promise.all for speed, but individual error handling\r\n            await Promise.all(validRows.map(async (item) => {\r\n                try {\r\n                    // 1. Find the Refund Doc\r\n                    const q = query(\r\n                        collection(db, \"refunds\"),\r\n                        where(\"merchantId\", \"==\", user.uid),\r\n                        where(\"orderId\", \"==\", item.orderId)\r\n                    );\r\n                    const snapshot = await getDocs(q);\r\n\r\n                    if (snapshot.empty) {\r\n                        newLogs.push(`‚ùå Order ${item.orderId}: Not found.`);\r\n                        return;\r\n                    }\r\n\r\n                    if (snapshot.size > 1) {\r\n                        newLogs.push(`‚ö†Ô∏è Order ${item.orderId}: Multiple matches found. Skipped for safety.`);\r\n                        return;\r\n                    }\r\n\r\n                    const docSnap = snapshot.docs[0];\r\n                    const refundData = docSnap.data();\r\n                    const docRef = doc(db, \"refunds\", docSnap.id);\r\n                    const now = new Date().toISOString();\r\n\r\n                    // 2. Prepare Updates\r\n                    const updates: Record<string, unknown> = {\r\n                        status: item.status\r\n                    };\r\n\r\n                    // Extra Fields based on Status\r\n                    if (item.status === 'SETTLED' && item.note) {\r\n                        updates['proofs.utr'] = item.note; // Use note as UTR/Proof\r\n                    }\r\n                    if (item.status === 'FAILED') {\r\n                        updates['failureReason'] = (item.note || '').toString().trim() || 'Unspecified Failure (Bulk Update)';\r\n                    }\r\n\r\n                    if (item.status === 'SETTLED') {\r\n                        // --- USE UNIVERSAL PAYOUT SERVICE (PHASE 3/5) ---\r\n                        await processSettlement(docSnap.id, user.uid, \"MANUAL\", {\r\n                            utrNumber: item.note,\r\n                            extraFields: {}\r\n                        });\r\n                    } else {\r\n                        // 3. Update Firestore (Fallback for non-settled statuses)\r\n                        await updateDoc(docRef, {\r\n                            ...updates,\r\n                            timeline: arrayUnion({\r\n                                status: item.status,\r\n                                title: item.status === 'FAILED' ? 'Refund Failed' : 'Status Updated',\r\n                                date: now,\r\n                                note: item.note || \"Bulk Update via CSV\"\r\n                            })\r\n                        });\r\n\r\n                        // 4. Update Scoreboard (If Failed)\r\n                        if (isFeatureEnabled(\"ENABLE_SCOREBOARD_AGGREGATION\") && item.status === 'FAILED') {\r\n                            updateScoreboard(userId, \"FAIL_REFUND\", refundData.amount);\r\n                        }\r\n                    }\r\n\r\n                    // 4. Trigger Email (ALL Statuses via Branded Notification Service)\r\n                    await sendUpdate(userId, { id: docSnap.id, ...refundData } as NotificationRefundData, item.status, {\r\n                        reason: item.note,      // For FAILED\r\n                        proofValue: item.note   // For SETTLED (UTR)\r\n                    });\r\n\r\n                    successCount++;\r\n                } catch (err) {\r\n                    console.error(`Error updating ${item.orderId}`, err);\r\n                    newLogs.push(`‚ùå Order ${item.orderId}: Update Failed.`);\r\n                } finally {\r\n                    completed++;\r\n                    setProgress(Math.round((completed / validRows.length) * 100));\r\n                }\r\n            }));\r\n\r\n\r\n            setResultLog({ success: successCount, errors: newLogs });\r\n            onSuccess();\r\n            // Do not auto-close. User must see report.\r\n\r\n        } catch (error) {\r\n            console.error(\"Bulk Update Critical Failure\", error);\r\n            setResultLog({ success: successCount, errors: [...newLogs, \"CRITICAL: System error during batch processing.\"] });\r\n        } finally {\r\n            setIsUpdating(false);\r\n        }\r\n    };\r\n\r\n    const handleDownloadTemplate = () => {\r\n        const headers = [\"orderId\", \"newStatus\", \"note\"];\r\n        const sampleRow = [\"#ORDER-123\", \"Settled\", \"UTR123456789 (Or Failure Reason)\"];\r\n        const csvContent = [headers.join(\",\"), sampleRow.join(\",\")].join(\"\\n\");\r\n\r\n        const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8;\" });\r\n        const url = URL.createObjectURL(blob);\r\n        const link = document.createElement(\"a\");\r\n        link.setAttribute(\"href\", url);\r\n        link.setAttribute(\"download\", \"status_update_template.csv\");\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm\">\r\n            <Card className=\"w-full max-w-lg relative bg-[#0A0A0A] border-white/10 max-h-[90vh] overflow-y-auto\">\r\n                <button onClick={onClose} className=\"absolute right-4 top-4 text-gray-400 hover:text-white\">\r\n                    <X size={20} />\r\n                </button>\r\n\r\n                {!resultLog && (\r\n                    <div className=\"mb-6\">\r\n                        <h2 className=\"text-xl font-bold text-white flex items-center gap-2\">\r\n                            <FileSignature className=\"text-yellow-500\" />\r\n                            Bulk Status Updater\r\n                        </h2>\r\n                        <p className=\"text-sm text-gray-400\">Update existing refunds via CSV.</p>\r\n                    </div>\r\n                )}\r\n\r\n                {resultLog ? (\r\n                    <div className=\"space-y-6\">\r\n                        <div className=\"text-center space-y-2\">\r\n                            <div className=\"inline-flex p-3 rounded-full bg-green-500/10 text-green-500 mb-2\">\r\n                                <CheckCircle2 size={32} />\r\n                            </div>\r\n                            <h3 className=\"text-xl font-bold text-white mb-3\">The &quot;WISMR&quot; Tax</h3>\r\n                            <div className=\"flex justify-center gap-4 text-sm\">\r\n                                <span className=\"text-green-400 font-medium\">Success: {resultLog.success}</span>\r\n                                <span className={resultLog.errors.length > 0 ? \"text-red-400 font-medium\" : \"text-gray-500\"}>\r\n                                    Skipped/Errors: {resultLog.errors.length}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {resultLog.errors.length > 0 ? (\r\n                            <div className=\"bg-red-500/5 border border-red-500/20 rounded-lg p-4\">\r\n                                <h4 className=\"text-xs font-bold text-red-500 uppercase tracking-wider mb-2 flex items-center gap-2\">\r\n                                    <AlertTriangle size={12} />\r\n                                    Error Report\r\n                                </h4>\r\n                                <div className=\"max-h-60 overflow-y-auto space-y-1 pr-2 custom-scrollbar\">\r\n                                    {resultLog.errors.map((err, i) => (\r\n                                        <div key={i} className=\"text-xs text-red-300 font-mono border-b border-red-500/10 last:border-0 pb-1 last:pb-0\">\r\n                                            {err}\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"p-4 bg-green-500/5 border border-green-500/10 rounded-lg text-center\">\r\n                                <p className=\"text-sm text-green-400\">All rows processed successfully!</p>\r\n                            </div>\r\n                        )}\r\n\r\n                        <Button onClick={onClose} className=\"w-full bg-white/10 hover:bg-white/20\">\r\n                            Close\r\n                        </Button>\r\n                    </div>\r\n                ) : !file ? (\r\n                    <>\r\n                        <div className=\"border-2 border-dashed border-white/10 rounded-xl p-10 text-center hover:border-yellow-500/30 transition-colors bg-white/5\">\r\n                            <Upload className=\"w-10 h-10 text-gray-500 mx-auto mb-4\" />\r\n                            <label className=\"block\">\r\n                                <span className=\"bg-yellow-600 text-black px-4 py-2 rounded-lg cursor-pointer hover:bg-yellow-500 transition-colors text-sm font-bold\">\r\n                                    Select CSV File\r\n                                </span>\r\n                                <input type=\"file\" accept=\".csv\" className=\"hidden\" onChange={handleFileChange} />\r\n                            </label>\r\n                            <p className=\"text-xs text-gray-500 mt-4\">\r\n                                Columns: orderId, newStatus, note\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"flex justify-center mt-4\">\r\n                            <button onClick={handleDownloadTemplate} className=\"flex items-center gap-2 text-xs text-gray-400 hover:text-white\">\r\n                                <Download size={14} /> Download Update Template\r\n                            </button>\r\n                        </div>\r\n                    </>\r\n                ) : (\r\n                    <div className=\"space-y-6\">\r\n                        <div className=\"grid grid-cols-3 gap-3 text-center\">\r\n                            <div className=\"p-3 bg-white/5 rounded-lg border border-white/10\">\r\n                                <p className=\"text-xs text-gray-400 uppercase\">Total</p>\r\n                                <p className=\"text-xl font-bold text-white\">{validationSummary.total}</p>\r\n                            </div>\r\n                            <div className=\"p-3 bg-green-500/10 rounded-lg border border-green-500/20\">\r\n                                <p className=\"text-xs text-green-400 uppercase\">Valid</p>\r\n                                <p className=\"text-xl font-bold text-green-400\">{validationSummary.valid}</p>\r\n                            </div>\r\n                            <div className=\"p-3 bg-red-500/10 rounded-lg border border-red-500/20\">\r\n                                <p className=\"text-xs text-red-400 uppercase\">invalid</p>\r\n                                <p className=\"text-xl font-bold text-red-400\">{validationSummary.invalid}</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {isUpdating && (\r\n                            <div className=\"w-full bg-white/10 rounded-full h-2 overflow-hidden\">\r\n                                <div className=\"bg-yellow-500 h-full transition-all duration-300\" style={{ width: `${progress}%` }}></div>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"flex gap-3 pt-2\">\r\n                            <Button variant=\"ghost\" onClick={() => { setFile(null); setLogs([]); }} disabled={isUpdating} className=\"flex-1\">\r\n                                Reset\r\n                            </Button>\r\n                            <Button\r\n                                onClick={handleUpdate}\r\n                                disabled={isUpdating || validationSummary.valid === 0}\r\n                                className=\"flex-1 flex items-center justify-center gap-2 bg-yellow-600 hover:bg-yellow-500 text-black font-bold\"\r\n                            >\r\n                                {isUpdating ? \"Updating...\" : (\r\n                                    <>\r\n                                        <Play size={16} fill=\"currentColor\" />\r\n                                        Update {validationSummary.valid} Refunds\r\n                                    </>\r\n                                )}\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </Card>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\dashboard\\CreateRefundModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\dashboard\\InvoiceTemplate.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\dashboard\\RefundDetailsPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\dashboard\\RefundMethodModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\dashboard\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\BentoFeatures.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\DemoDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'elementCenter' is assigned a value but never used.","line":174,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":174,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState, useRef, useCallback } from \"react\";\r\n\r\ntype Screen = \"LOGIN\" | \"DASHBOARD\" | \"CREATE\" | \"DETAILS\";\r\n\r\nexport default function DemoDashboard() {\r\n    const [screen, setScreen] = useState<Screen>(\"LOGIN\");\r\n    const [cursorPos, setCursorPos] = useState({ x: \"50%\", y: \"110%\" }); // Start off-screen\r\n    const [isClicking, setIsClicking] = useState(false);\r\n\r\n    // Form States\r\n    const [email, setEmail] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [customerName, setCustomerName] = useState(\"\");\r\n    const [amount, setAmount] = useState(\"\");\r\n    const [utr, setUtr] = useState(\"\");\r\n    const [status, setStatus] = useState(\"Processing\");\r\n    const [showUtrModal, setShowUtrModal] = useState(false);\r\n\r\n    // Refs for animation coordination\r\n    const isAnimating = useRef(false);\r\n    const isMounted = useRef(true);\r\n\r\n    // --- HELPER FUNCTIONS ---\r\n    const wait = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));\r\n\r\n    const click = useCallback(async () => {\r\n        setIsClicking(true);\r\n        await wait(150);\r\n        setIsClicking(false);\r\n    }, []);\r\n\r\n    const typeText = useCallback(async (text: string, setter: (s: string) => void) => {\r\n        for (let i = 1; i <= text.length; i++) {\r\n            if (!isMounted.current) break;\r\n            setter(text.slice(0, i));\r\n            await wait(Math.random() * 30 + 30); // Random typing speed\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        isMounted.current = true;\r\n        if (isAnimating.current) return;\r\n        isAnimating.current = true;\r\n\r\n        const runSequence = async () => {\r\n            while (isMounted.current) {\r\n                // ... (rest of the sequence logic stays the same)\r\n                if (!isMounted.current) break;\r\n                setScreen(\"LOGIN\");\r\n                setEmail(\"\");\r\n                setPassword(\"\");\r\n                setCustomerName(\"\");\r\n                setAmount(\"\");\r\n                setUtr(\"\");\r\n                setStatus(\"Processing\");\r\n                setShowUtrModal(false);\r\n                setCursorPos({ x: \"50%\", y: \"110%\" });\r\n\r\n                await wait(1000);\r\n                if (!isMounted.current) break;\r\n\r\n                // --- SCENE 1: LOGIN ---\r\n                setCursorPos({ x: \"50%\", y: \"42%\" });\r\n                await wait(1000);\r\n                if (!isMounted.current) break;\r\n                await typeText(\"merchant@ryyt.com\", setEmail);\r\n                if (!isMounted.current) break;\r\n\r\n                setCursorPos({ x: \"50%\", y: \"55%\" });\r\n                await wait(500);\r\n                if (!isMounted.current) break;\r\n                await typeText(\"********\", setPassword);\r\n                if (!isMounted.current) break;\r\n\r\n                setCursorPos({ x: \"50%\", y: \"68%\" });\r\n                await wait(800);\r\n                if (!isMounted.current) break;\r\n                await click();\r\n                if (!isMounted.current) break;\r\n\r\n                await wait(500);\r\n                if (!isMounted.current) break;\r\n                setScreen(\"DASHBOARD\");\r\n\r\n                // --- SCENE 2: DASHBOARD ---\r\n                setCursorPos({ x: \"20%\", y: \"30%\" });\r\n                await wait(800);\r\n                if (!isMounted.current) break;\r\n                setCursorPos({ x: \"70%\", y: \"40%\" });\r\n                await wait(800);\r\n                if (!isMounted.current) break;\r\n\r\n                setCursorPos({ x: \"88%\", y: \"15%\" });\r\n                await wait(1000);\r\n                if (!isMounted.current) break;\r\n                await click();\r\n                if (!isMounted.current) break;\r\n\r\n                setScreen(\"CREATE\");\r\n\r\n                // --- SCENE 3: CREATE ---\r\n                setCursorPos({ x: \"30%\", y: \"35%\" });\r\n                await wait(800);\r\n                if (!isMounted.current) break;\r\n                await typeText(\"Ananya Gupta\", setCustomerName);\r\n                if (!isMounted.current) break;\r\n\r\n                setCursorPos({ x: \"70%\", y: \"35%\" });\r\n                await wait(500);\r\n                if (!isMounted.current) break;\r\n                await typeText(\"4500\", setAmount);\r\n                if (!isMounted.current) break;\r\n\r\n                setCursorPos({ x: \"85%\", y: \"85%\" });\r\n                await wait(1000);\r\n                if (!isMounted.current) break;\r\n                await click();\r\n                if (!isMounted.current) break;\r\n\r\n                setScreen(\"DETAILS\");\r\n\r\n                // --- SCENE 4: DETAILS ---\r\n                setCursorPos({ x: \"85%\", y: \"20%\" });\r\n                await wait(1500);\r\n                if (!isMounted.current) break;\r\n                await click();\r\n                if (!isMounted.current) break;\r\n                setShowUtrModal(true);\r\n\r\n                setCursorPos({ x: \"50%\", y: \"50%\" });\r\n                await wait(800);\r\n                if (!isMounted.current) break;\r\n                await click();\r\n                if (!isMounted.current) break;\r\n                await typeText(\"HDFC00088219\", setUtr);\r\n                if (!isMounted.current) break;\r\n\r\n                setCursorPos({ x: \"50%\", y: \"70%\" });\r\n                await wait(800);\r\n                if (!isMounted.current) break;\r\n                await click();\r\n                if (!isMounted.current) break;\r\n\r\n                setShowUtrModal(false);\r\n                setStatus(\"Completed\");\r\n\r\n                setCursorPos({ x: \"90%\", y: \"90%\" });\r\n                await wait(3000);\r\n            }\r\n        };\r\n\r\n        runSequence();\r\n\r\n        return () => {\r\n            isMounted.current = false;\r\n        };\r\n    }, [click, typeText]);\r\n\r\n    // --- SCROLL ANIMATION ---\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n    const [transformStyle, setTransformStyle] = useState({});\r\n\r\n    useEffect(() => {\r\n        const handleScroll = () => {\r\n            if (!containerRef.current) return;\r\n\r\n            const rect = containerRef.current.getBoundingClientRect();\r\n            const windowHeight = window.innerHeight;\r\n\r\n            // Calculate progress: 0 when element is at bottom, 1 when at center\r\n            // We want it to start untiliting as it enters view\r\n            const elementCenter = rect.top + rect.height / 2;\r\n            const triggerPoint = windowHeight * 0.8; // Start animating when it's 80% down the screen\r\n\r\n            let progress = (triggerPoint - rect.top) / (windowHeight * 0.5);\r\n            progress = Math.max(0, Math.min(1, progress)); // Clamp between 0 and 1\r\n\r\n            // Tilt: 45deg at start, 0deg at end\r\n            const rotateX = 45 * (1 - progress);\r\n            // Scale: 0.8 at start, 1 at end\r\n            const scale = 0.8 + (0.2 * progress);\r\n            // Opacity: Fade in slightly\r\n            const opacity = 0.5 + (0.5 * progress);\r\n\r\n            setTransformStyle({\r\n                transform: `perspective(1000px) rotateX(${rotateX}deg) scale(${scale})`,\r\n                opacity: opacity,\r\n                transition: \"transform 0.1s ease-out\" // Smooth out the scroll updates\r\n            });\r\n        };\r\n\r\n        window.addEventListener(\"scroll\", handleScroll);\r\n        handleScroll(); // Initial check\r\n        return () => window.removeEventListener(\"scroll\", handleScroll);\r\n    }, []);\r\n\r\n    return (\r\n        <div\r\n            ref={containerRef}\r\n            className=\"w-full max-w-5xl relative z-10 mx-auto group\"\r\n            style={transformStyle}\r\n        >\r\n            {/* Glow Effect */}\r\n            <div className=\"absolute -inset-1 bg-gradient-to-r from-blue-500/30 via-white/20 to-purple-500/30 rounded-[30px] blur-2xl opacity-90 transition duration-1000 group-hover:opacity-100 group-hover:blur-3xl group-hover:via-white/30\"></div>\r\n\r\n            <div className=\"rounded-[24px] border border-white/10 bg-[#050505] shadow-2xl overflow-hidden relative\">\r\n                {/* Top Glow Line */}\r\n                <div className=\"absolute top-0 left-0 right-0 h-[1px] bg-gradient-to-r from-transparent via-blue-500/50 to-transparent opacity-50\"></div>\r\n\r\n                {/* Mock UI Container */}\r\n                <div className=\"relative bg-[#0A0A0A] p-1 h-[600px] select-none\">\r\n                    <div className=\"bg-[#0f0f0f] rounded-[20px] overflow-hidden border border-white/5 h-full flex flex-col relative\">\r\n\r\n                        {/* --- SCREEN: LOGIN --- */}\r\n                        {screen === \"LOGIN\" && (\r\n                            <div className=\"absolute inset-0 flex items-center justify-center bg-[#0f0f0f] z-10 transition-opacity duration-500\">\r\n                                <div className=\"w-[320px] space-y-6\">\r\n                                    <div className=\"text-center space-y-2\">\r\n                                        <div className=\"w-12 h-12 bg-blue-600/20 rounded-xl mx-auto flex items-center justify-center border border-blue-500/20\">\r\n                                            <div className=\"w-6 h-6 bg-blue-500 rounded-full\"></div>\r\n                                        </div>\r\n                                        <h3 className=\"text-xl font-bold text-white\">Welcome Back</h3>\r\n                                        <p className=\"text-xs text-gray-500\">Enter your credentials to access the dashboard.</p>\r\n                                    </div>\r\n                                    <div className=\"space-y-3\">\r\n                                        <div className=\"space-y-1\">\r\n                                            <label className=\"text-[10px] uppercase tracking-wider text-gray-500 font-medium\">Email</label>\r\n                                            <div className=\"h-10 bg-[#1a1a1a] border border-white/10 rounded-lg flex items-center px-3 text-sm text-white\">\r\n                                                {email}<span className=\"animate-pulse\">|</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"space-y-1\">\r\n                                            <label className=\"text-[10px] uppercase tracking-wider text-gray-500 font-medium\">Password</label>\r\n                                            <div className=\"h-10 bg-[#1a1a1a] border border-white/10 rounded-lg flex items-center px-3 text-sm text-white\">\r\n                                                {password ? \"‚Ä¢\".repeat(password.length) : \"\"}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <button className=\"w-full h-10 bg-blue-600 rounded-lg text-white text-sm font-medium shadow-lg shadow-blue-900/20\">\r\n                                        Sign In\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* --- SCREEN: DASHBOARD --- */}\r\n                        {screen === \"DASHBOARD\" && (\r\n                            <div className=\"absolute inset-0 bg-[#0f0f0f] z-10 transition-opacity duration-500 flex flex-col\">\r\n                                {/* Nav */}\r\n                                <div className=\"h-14 border-b border-white/5 flex items-center justify-between px-6 bg-[#111]\">\r\n                                    <div className=\"font-bold text-white tracking-tight\">RYYT <span className=\"text-blue-500\">.</span></div>\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        <div className=\"text-xs text-gray-400\">Overview</div>\r\n                                        <div className=\"text-xs text-white font-medium\">Refunds</div>\r\n                                        <button className=\"px-3 py-1.5 bg-white text-black text-xs font-bold rounded-md\">\r\n                                            + New Refund\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                                {/* Content */}\r\n                                <div className=\"p-6 space-y-6\">\r\n                                    <div className=\"grid grid-cols-3 gap-4\">\r\n                                        {[\r\n                                            { label: \"Total Refunds\", val: \"‚Çπ1,24,500\", color: \"text-white\" },\r\n                                            { label: \"Processing\", val: \"12\", color: \"text-yellow-400\" },\r\n                                            { label: \"Completed\", val: \"148\", color: \"text-green-400\" }\r\n                                        ].map((stat, i) => (\r\n                                            <div key={i} className=\"bg-[#161616] border border-white/5 p-4 rounded-xl space-y-1\">\r\n                                                <div className=\"text-[10px] uppercase text-gray-500 font-medium\">{stat.label}</div>\r\n                                                <div className={`text-xl font-mono font-medium ${stat.color}`}>{stat.val}</div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                    <div className=\"bg-[#161616] border border-white/5 rounded-xl overflow-hidden flex-1\">\r\n                                        <div className=\"px-4 py-3 border-b border-white/5 text-xs font-medium text-gray-400\">Recent Activity</div>\r\n                                        {[1, 2, 3].map((_, i) => (\r\n                                            <div key={i} className=\"px-4 py-3 border-b border-white/5 flex items-center justify-between\">\r\n                                                <div className=\"flex items-center gap-3\">\r\n                                                    <div className=\"w-8 h-8 rounded-full bg-white/5\"></div>\r\n                                                    <div>\r\n                                                        <div className=\"text-xs text-white font-medium\">Order #{4920 - i}</div>\r\n                                                        <div className=\"text-[10px] text-gray-500\">Just now</div>\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div className=\"text-xs text-gray-400\">‚Çπ{1200 + i * 500}</div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* --- SCREEN: CREATE --- */}\r\n                        {screen === \"CREATE\" && (\r\n                            <div className=\"absolute inset-0 bg-[#0f0f0f] z-10 transition-all duration-300 flex flex-col\">\r\n                                <div className=\"h-14 border-b border-white/5 flex items-center px-6 bg-[#111]\">\r\n                                    <div className=\"text-sm font-medium text-white\">Create Manual Refund</div>\r\n                                </div>\r\n                                <div className=\"p-8 space-y-6 max-w-lg mx-auto w-full mt-4\">\r\n                                    <div className=\"grid grid-cols-2 gap-4\">\r\n                                        <div className=\"space-y-1\">\r\n                                            <label className=\"text-[10px] uppercase text-gray-500\">Customer Name</label>\r\n                                            <div className=\"h-10 bg-[#161616] border border-white/10 rounded-lg flex items-center px-3 text-sm text-white\">\r\n                                                {customerName}<span className=\"animate-pulse\">|</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"space-y-1\">\r\n                                            <label className=\"text-[10px] uppercase text-gray-500\">Amount (‚Çπ)</label>\r\n                                            <div className=\"h-10 bg-[#161616] border border-white/10 rounded-lg flex items-center px-3 text-sm text-white\">\r\n                                                {amount}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"h-24 bg-[#161616] border border-white/10 rounded-lg p-3 text-sm text-gray-500\">\r\n                                        Reason for refund...\r\n                                    </div>\r\n                                    <div className=\"flex justify-end pt-4\">\r\n                                        <button className=\"px-6 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium\">\r\n                                            Create Refund\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* --- SCREEN: DETAILS (TRACKING) --- */}\r\n                        {screen === \"DETAILS\" && (\r\n                            <div className=\"absolute inset-0 bg-[#0f0f0f] z-10 transition-opacity duration-500 flex flex-col\">\r\n                                <div className=\"h-16 border-b border-white/5 flex items-center px-8 justify-between bg-[#111]\">\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        <div className=\"text-sm font-medium text-gray-400\">Refund #RF-9921</div>\r\n                                        <div className={`px-3 py-1 rounded-full text-xs font-medium border transition-colors duration-300 ${status === \"Completed\"\r\n                                            ? \"bg-green-500/10 text-green-400 border-green-500/20\"\r\n                                            : \"bg-yellow-500/10 text-yellow-400 border-yellow-500/20\"\r\n                                            }`}>\r\n                                            {status}\r\n                                        </div>\r\n                                    </div>\r\n                                    <button className=\"px-4 py-2 rounded-lg bg-white/5 text-white text-sm font-medium hover:bg-white/10 border border-white/10 transition-colors\">\r\n                                        Update Status\r\n                                    </button>\r\n                                </div>\r\n\r\n                                <div className=\"p-8 space-y-8\">\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <div>\r\n                                            <div className=\"text-2xl font-bold text-white\">{customerName || \"Ananya Gupta\"}</div>\r\n                                            <div className=\"text-sm text-gray-500\">via UPI ‚Ä¢ {amount ? `‚Çπ${amount}` : \"‚Çπ4,500\"}</div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Timeline / Status Box */}\r\n                                    <div className={`p-6 rounded-xl border transition-all duration-500 ${status === \"Completed\"\r\n                                        ? \"bg-green-900/10 border-green-500/30\"\r\n                                        : \"bg-[#161616] border-white/5 border-dashed\"\r\n                                        }`}>\r\n                                        <label className=\"text-xs text-gray-500 uppercase tracking-wider block mb-2\">\r\n                                            {status === \"Completed\" ? \"Transaction Reference (UTR)\" : \"Current Status\"}\r\n                                        </label>\r\n\r\n                                        {status === \"Completed\" ? (\r\n                                            <div className=\"space-y-2 animate-in slide-in-from-bottom-2\">\r\n                                                <div className=\"text-2xl font-mono text-green-400 tracking-wide\">{utr}</div>\r\n                                                <div className=\"text-sm text-gray-400 flex items-center gap-2\">\r\n                                                    <svg className=\"w-4 h-4 text-green-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" /></svg>\r\n                                                    Verified &amp; Notified\r\n                                                </div>\r\n                                            </div>\r\n                                        ) : (\r\n                                            <div className=\"flex items-center gap-3 text-yellow-500/80\">\r\n                                                <div className=\"w-2 h-2 bg-yellow-500 rounded-full animate-pulse\"></div>\r\n                                                <span className=\"text-sm font-mono\">Processing with Bank...</span>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Modal */}\r\n                                {showUtrModal && (\r\n                                    <div className=\"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-20 transition-opacity duration-200\">\r\n                                        <div className=\"w-[350px] bg-[#111] border border-white/10 rounded-xl p-6 shadow-2xl\">\r\n                                            <h3 className=\"text-white font-medium mb-4\">Complete Refund</h3>\r\n                                            <div className=\"space-y-4\">\r\n                                                <div>\r\n                                                    <label className=\"text-xs text-gray-400 block mb-1\">UTR / Reference Number</label>\r\n                                                    <div className=\"w-full bg-[#050505] border border-white/10 rounded-lg px-3 py-2 text-sm text-white font-mono flex items-center h-10\">\r\n                                                        {utr}<span className=\"animate-pulse\">|</span>\r\n                                                    </div>\r\n                                                </div>\r\n                                                <button className=\"w-full bg-blue-600 text-white rounded-lg py-2 text-sm font-medium mt-2\">\r\n                                                    Confirm & Notify\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Fake Cursor */}\r\n                        <div\r\n                            className=\"absolute pointer-events-none transition-all duration-700 ease-[cubic-bezier(0.25,0.1,0.25,1.0)] z-50 drop-shadow-2xl\"\r\n                            style={{\r\n                                left: cursorPos.x,\r\n                                top: cursorPos.y,\r\n                                transform: isClicking ? \"scale(0.8)\" : \"scale(1)\"\r\n                            }}\r\n                        >\r\n                            <svg width=\"24\" height=\"24\" viewBox=\"0 0 32 32\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                <path d=\"M10.5 28L8.5 6L26.5 18L17.5 20L23.5 29.5L20.5 31.5L14.5 22L10.5 28Z\" fill=\"black\" stroke=\"white\" strokeWidth=\"2\" />\r\n                            </svg>\r\n                        </div>\r\n\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\FAQ.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\FeaturesBento.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\FinalHero.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Smartphone' is defined but never used.","line":4,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { motion, useMotionValue, useSpring, useTransform, AnimatePresence, animate } from 'framer-motion';\r\nimport { ArrowRight, Search, Smartphone, Zap } from 'lucide-react';\r\nimport Image from 'next/image';\r\n\r\nimport { useModal } from '@/context/ModalContext';\r\n\r\nexport default function FinalHero() {\r\n    const { openLeadModal } = useModal();\r\n    return (\r\n        <section className=\"relative w-full pt-32 pb-20 flex flex-col items-center justify-center perspective-[2000px] overflow-hidden\">\r\n            {/* Background Glow */}\r\n            <div className=\"absolute top-[-20%] left-1/2 -translate-x-1/2 w-[1200px] h-[800px] rounded-full bg-[#0052FF]/15 blur-[120px] pointer-events-none\" />\r\n\r\n            <div className=\"container mx-auto px-4 text-center mb-12 relative z-10\">\r\n                <motion.h1\r\n                    initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.8 }}\r\n                    className=\"text-5xl md:text-7xl font-bold tracking-tight text-white mb-6 leading-[1.1]\"\r\n                >\r\n                    Make Refunds<br />\r\n                    <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-white via-[#0052FF] to-blue-400\">\r\n                        Seamless, Not Stressful.\r\n                    </span>\r\n                </motion.h1>\r\n                <motion.p\r\n                    initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}\r\n                    className=\"text-lg md:text-xl text-zinc-400 max-w-2xl mx-auto mb-10 leading-relaxed\"\r\n                >\r\n                    No more chasing COD customers for UPI IDs or guessing refund status. Ryyt automates collection, communication, and tracking. We turn refund chaos into trust-building moments for your D2C brand.\r\n                </motion.p>\r\n                <motion.div\r\n                    initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}\r\n                    className=\"flex flex-col sm:flex-row gap-4 justify-center\"\r\n                >\r\n                    <button\r\n                        onClick={openLeadModal}\r\n                        className=\"px-8 py-4 bg-[#0052FF]/60 backdrop-blur-xl border border-[#0052FF]/50 shadow-[0_0_20px_-5px_rgba(0,82,255,0.5)] hover:bg-[#0052FF]/80 hover:shadow-[0_0_30px_-5px_rgba(0,82,255,0.6)] hover:border-[#0052FF]/80 text-white font-bold rounded-full transition-all duration-300 flex items-center justify-center gap-2 group\"\r\n                    >\r\n                        Regain Control <ArrowRight size={20} className=\"group-hover:translate-x-1 transition-transform\" />\r\n                    </button>\r\n                    <button\r\n                        onClick={() => document.getElementById('features')?.scrollIntoView({ behavior: 'smooth' })}\r\n                        className=\"px-8 py-4 bg-white/5 backdrop-blur-xl border border-white/10 shadow-[0_0_20px_-5px_rgba(255,255,255,0.1)] hover:bg-white/10 hover:border-white/20 text-white font-bold rounded-full transition-all duration-300 flex items-center justify-center gap-2\"\r\n                    >\r\n                        How it works\r\n                    </button>\r\n                </motion.div>\r\n\r\n                {/* Social Proof */}\r\n                <motion.div\r\n                    initial={{ opacity: 0 }}\r\n                    animate={{ opacity: 1 }}\r\n                    transition={{ delay: 0.5 }}\r\n                    className=\"mt-8 flex items-center justify-center gap-2 text-sm text-zinc-500\"\r\n                >\r\n                    <div className=\"flex -space-x-3\">\r\n                        <Image width={32} height={32} src=\"https://randomuser.me/api/portraits/men/32.jpg\" alt=\"User\" className=\"w-8 h-8 rounded-full border-2 border-[#0A0A0A]\" />\r\n                        <Image width={32} height={32} src=\"https://randomuser.me/api/portraits/women/44.jpg\" alt=\"User\" className=\"w-8 h-8 rounded-full border-2 border-[#0A0A0A]\" />\r\n                        <Image width={32} height={32} src=\"https://randomuser.me/api/portraits/men/86.jpg\" alt=\"User\" className=\"w-8 h-8 rounded-full border-2 border-[#0A0A0A]\" />\r\n                        <Image width={32} height={32} src=\"https://randomuser.me/api/portraits/women/65.jpg\" alt=\"User\" className=\"w-8 h-8 rounded-full border-2 border-[#0A0A0A]\" />\r\n                    </div>\r\n                    <p>\r\n                        Trusted by <span className=\"font-bold text-white\"><Counter value={1200} />+</span> D2C Founders & Brands\r\n                    </p>\r\n                </motion.div>\r\n            </div>\r\n\r\n            {/* 3D Dashboard */}\r\n            <div className=\"mt-16 w-full\">\r\n                <InteractiveDashboard />\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n\r\nfunction InteractiveDashboard() {\r\n    const [currentSlide, setCurrentSlide] = useState(0);\r\n    const ref = useRef<HTMLDivElement>(null);\r\n\r\n    useEffect(() => {\r\n        const timer = setInterval(() => setCurrentSlide((p) => (p + 1) % 3), 5000);\r\n        return () => clearInterval(timer);\r\n    }, []);\r\n\r\n    const x = useMotionValue(0);\r\n    const y = useMotionValue(0);\r\n    const mouseXSpring = useSpring(x);\r\n    const mouseYSpring = useSpring(y);\r\n    const rotateX = useTransform(mouseYSpring, [-0.5, 0.5], [\"5deg\", \"-5deg\"]);\r\n    const rotateY = useTransform(mouseXSpring, [-0.5, 0.5], [\"-5deg\", \"5deg\"]);\r\n\r\n    const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {\r\n        if (!ref.current) return;\r\n        const rect = ref.current.getBoundingClientRect();\r\n        x.set((e.clientX - rect.left) / rect.width - 0.5);\r\n        y.set((e.clientY - rect.top) / rect.height - 0.5);\r\n    };\r\n\r\n    return (\r\n        <motion.div\r\n            ref={ref} onMouseMove={handleMouseMove} onMouseLeave={() => { x.set(0); y.set(0); }}\r\n            style={{ rotateX, rotateY, transformStyle: \"preserve-3d\" }}\r\n            initial={{ opacity: 0, scale: 0.9, rotateX: 20 }} animate={{ opacity: 1, scale: 1, rotateX: 0 }} transition={{ delay: 0.5, duration: 1 }}\r\n            className=\"relative mx-auto max-w-6xl h-[600px] w-full z-20 px-4\"\r\n        >\r\n            {/* --- THE HALO GLOW EFFECT --- */}\r\n\r\n            {/* Layer 1: The \"Atmosphere\" (Wide & Soft) */}\r\n            <div\r\n                className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[120%] h-[120%] bg-[#0052FF]/10 blur-[100px] rounded-full -z-10 pointer-events-none\"\r\n            />\r\n\r\n            {/* Layer 2: The \"Core\" (Tight & Bright) */}\r\n            <div\r\n                className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[80%] h-[80%] bg-gradient-to-tr from-[#0052FF]/30 to-purple-500/30 blur-[60px] rounded-full -z-10 animate-pulse pointer-events-none\"\r\n                style={{ animationDuration: '4s' }}\r\n            />\r\n\r\n            {/* Layer 3: The \"Rim\" (Subtle Edge Highlight) */}\r\n            <div className=\"absolute -inset-1 bg-gradient-to-b from-[#0052FF]/20 to-transparent rounded-xl blur-md -z-10 opacity-50\" />\r\n            <div className=\"w-full h-full bg-[#0A0A0A]/80 backdrop-blur-2xl border border-white/10 rounded-xl shadow-2xl shadow-blue-900/10 overflow-hidden flex flex-col\">\r\n                <div className=\"h-14 border-b border-white/5 flex items-center justify-between px-6 bg-white/[0.02]\">\r\n                    <div className=\"flex gap-2\"><div className=\"w-3 h-3 rounded-full bg-red-500/20\" /><div className=\"w-3 h-3 rounded-full bg-yellow-500/20\" /><div className=\"w-3 h-3 rounded-full bg-green-500/20\" /></div>\r\n                    <div className=\"w-96 h-9 bg-zinc-900/50 rounded-lg border border-white/5 flex items-center px-4 text-xs text-zinc-600\"><Search size={14} className=\"mr-2\" /> Search...</div>\r\n                </div>\r\n                <div className=\"relative flex-1 w-full overflow-hidden bg-zinc-950/50\">\r\n                    <AnimatePresence mode=\"wait\">\r\n                        <motion.div key={currentSlide} initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }} transition={{ duration: 0.4 }} className=\"absolute inset-0 p-8 flex items-center justify-center\">\r\n                            {currentSlide === 0 && <AnalyticsMockup />}\r\n                            {currentSlide === 1 && <TableMockup />}\r\n                            {currentSlide === 2 && <QRMockup />}\r\n                        </motion.div>\r\n                    </AnimatePresence>\r\n                </div>\r\n                <div className=\"h-12 border-t border-white/5 flex items-center justify-center gap-3\">\r\n                    {[0, 1, 2].map(i => <div key={i} className={`h-1.5 rounded-full transition-all duration-500 ${i === currentSlide ? 'w-8 bg-[#0052FF]' : 'w-2 bg-zinc-800'}`} />)}\r\n                </div>\r\n            </div>\r\n        </motion.div>\r\n    );\r\n}\r\n\r\n// Sub-components for slides\r\nfunction AnalyticsMockup() {\r\n    return (\r\n        <div className=\"w-full h-full flex gap-4\">\r\n            {/* Left: Main Chart Card */}\r\n            <div className=\"flex-[2] bg-zinc-900/80 backdrop-blur-md rounded-xl border border-white/10 p-5 flex flex-col relative overflow-hidden group\">\r\n                {/* Engineering Grid Background */}\r\n                <div className=\"absolute inset-0 bg-[linear-gradient(to_right,#ffffff05_1px,transparent_1px),linear-gradient(to_bottom,#ffffff05_1px,transparent_1px)] bg-[size:16px_16px] pointer-events-none\" />\r\n\r\n                {/* Header */}\r\n                <div className=\"flex justify-between items-start mb-4 z-10\">\r\n                    <div>\r\n                        <div className=\"text-xs font-medium text-zinc-500 uppercase tracking-wider mb-1\">Total Settled</div>\r\n                        <div className=\"text-3xl font-bold text-white tracking-tight flex items-baseline gap-2\">\r\n                            ‚Çπ4.2L <span className=\"text-xs font-normal text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded-full border border-emerald-400/20\">+12.5%</span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 bg-zinc-950/80 rounded-full px-2 py-1 border border-white/10\">\r\n                        <div className=\"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse shadow-[0_0_8px_rgba(16,185,129,0.8)]\" />\r\n                        <span className=\"text-[10px] font-bold text-emerald-500 tracking-wide\">LIVE</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Animated Area Chart */}\r\n                <div className=\"flex-1 relative w-full h-full min-h-[80px]\">\r\n                    <svg className=\"w-full h-full overflow-visible\" preserveAspectRatio=\"none\" viewBox=\"0 0 100 50\">\r\n                        <defs>\r\n                            <linearGradient id=\"chartGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                <stop offset=\"0%\" stopColor=\"#4F46E5\" stopOpacity=\"0.3\" />\r\n                                <stop offset=\"100%\" stopColor=\"#4F46E5\" stopOpacity=\"0\" />\r\n                            </linearGradient>\r\n                        </defs>\r\n                        <motion.path\r\n                            d=\"M0,50 L0,35 C15,35 20,20 30,22 C40,24 45,35 55,35 C65,35 70,10 80,12 C90,14 95,25 100,20 L100,50 Z\"\r\n                            fill=\"url(#chartGradient)\"\r\n                            initial={{ opacity: 0, pathLength: 0 }}\r\n                            animate={{ opacity: 1, pathLength: 1 }}\r\n                            transition={{ duration: 1.5, ease: \"easeOut\" }}\r\n                        />\r\n                        <motion.path\r\n                            d=\"M0,35 C15,35 20,20 30,22 C40,24 45,35 55,35 C65,35 70,10 80,12 C90,14 95,25 100,20\"\r\n                            fill=\"none\"\r\n                            stroke=\"#4F46E5\"\r\n                            strokeWidth=\"1.5\"\r\n                            strokeLinecap=\"round\"\r\n                            filter=\"drop-shadow(0 0 6px rgba(79, 70, 229, 0.6))\"\r\n                            initial={{ pathLength: 0 }}\r\n                            animate={{ pathLength: 1 }}\r\n                            transition={{ duration: 1.5, ease: \"easeOut\" }}\r\n                        />\r\n                    </svg>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Right: Metrics Stack */}\r\n            <div className=\"flex-1 flex flex-col gap-3\">\r\n                {/* Metric 1: Success Rate */}\r\n                <div className=\"flex-1 bg-zinc-900/80 backdrop-blur-md rounded-xl border border-white/10 p-4 flex flex-col justify-center relative overflow-hidden\">\r\n                    <div className=\"absolute top-0 right-0 w-24 h-24 bg-emerald-500/5 blur-[40px] rounded-full\" />\r\n                    <div className=\"relative z-10\">\r\n                        <div className=\"text-xs font-medium text-zinc-500 uppercase tracking-wider mb-1\">Success Rate</div>\r\n                        <div className=\"text-3xl font-bold text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.15)]\">99.8%</div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Metric 2: Identity Guard */}\r\n                <div className=\"flex-[1.2] bg-[#0052FF]/10 backdrop-blur-md rounded-xl border border-[#0052FF]/30 p-4 flex flex-col justify-center relative overflow-hidden\">\r\n                    <div className=\"flex items-center gap-2 mb-2\">\r\n                        <div className=\"p-1 rounded bg-[#0052FF]/20\">\r\n                            {/* Shield Icon SVG */}\r\n                            <svg className=\"w-3 h-3 text-[#0052FF]\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\" /></svg>\r\n                        </div>\r\n                        <span className=\"text-[9px] font-bold text-[#0052FF] uppercase tracking-widest\">Identity Guard</span>\r\n                    </div>\r\n                    <div className=\"text-2xl font-bold text-white\">1,240</div>\r\n                    <div className=\"text-[10px] text-zinc-400 mt-0.5\">Threats Intercepted</div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction TableMockup() {\r\n    const rows = [\r\n        { id: \"101\", customer: \"Arjun K.\", amount: \"‚Çπ1,200\", status: \"GATHERING DATA\", lastAction: \"UPI Link Sent\", color: \"text-amber-400 bg-amber-400/5 border-amber-400/20 shadow-[0_0_10px_rgba(251,191,36,0.1)]\" },\r\n        { id: \"102\", customer: \"Sarah L.\", amount: \"‚Çπ850\", status: \"REFUND INITIATED\", lastAction: \"Identity Verified\", color: \"text-blue-400 bg-blue-400/5 border-blue-400/20 shadow-[0_0_10px_rgba(96,165,250,0.1)]\" },\r\n        { id: \"103\", customer: \"Dev P.\", amount: \"‚Çπ2,400\", status: \"SETTLED\", lastAction: \"UTR #7858... Generated\", color: \"text-emerald-400 bg-emerald-400/5 border-emerald-400/20 shadow-[0_0_10px_rgba(52,211,153,0.1)]\" },\r\n        { id: \"104\", customer: \"Rohan D.\", amount: \"‚Çπ450\", status: \"SETTLED\", lastAction: \"UTR #9921... Generated\", color: \"text-emerald-400 bg-emerald-400/5 border-emerald-400/20 shadow-[0_0_10px_rgba(52,211,153,0.1)]\" }\r\n    ];\r\n\r\n    return (\r\n        <div className=\"w-full h-full bg-white/[0.03] rounded-lg border border-white/5 flex flex-col relative overflow-hidden\">\r\n            {/* Scanning Light Effect */}\r\n            <motion.div\r\n                initial={{ top: \"-20%\" }}\r\n                animate={{ top: \"120%\" }}\r\n                transition={{ duration: 4, repeat: Infinity, ease: \"linear\" }}\r\n                className=\"absolute left-0 w-full h-24 bg-gradient-to-b from-transparent via-blue-500/5 to-transparent pointer-events-none z-0\"\r\n            />\r\n\r\n            <div className=\"h-10 border-b border-white/5 flex items-center px-6 gap-4 text-xs text-zinc-500 font-bold uppercase bg-white/[0.02] z-10 relative\">\r\n                <div className=\"w-1/5 tracking-widest\">Order</div>\r\n                <div className=\"w-1/4 tracking-widest\">Customer</div>\r\n                <div className=\"w-1/5 text-right tracking-widest\">Amount</div>\r\n                <div className=\"w-1/3 text-center tracking-widest\">Status / Logic</div>\r\n            </div>\r\n\r\n            <div className=\"flex-1 overflow-hidden z-10 relative\">\r\n                {rows.map((row, i) => (\r\n                    <motion.div\r\n                        key={i}\r\n                        initial={{ opacity: 0, x: -20 }}\r\n                        animate={{ opacity: 1, x: 0 }}\r\n                        transition={{ delay: i * 0.15 + 0.2 }}\r\n                        className=\"h-[72px] border-b border-white/5 flex items-center px-6 gap-4 text-sm hover:bg-white/[0.06] transition-colors\"\r\n                    >\r\n                        {/* Order ID */}\r\n                        <div className=\"w-1/5 text-blue-400/80 font-mono text-[10px] tracking-wide drop-shadow-[0_0_8px_rgba(96,165,250,0.3)]\">#ORD-{row.id}</div>\r\n\r\n                        {/* Customer + Shield */}\r\n                        <div className=\"w-1/4 flex items-center gap-2 overflow-hidden\">\r\n                            {(row.status === \"SETTLED\" || row.status === \"REFUND INITIATED\") && (\r\n                                <motion.div animate={{ opacity: [0.4, 1, 0.4] }} transition={{ duration: 3, repeat: Infinity }} title=\"Identity Verified\">\r\n                                    <svg className=\"w-3.5 h-3.5 text-emerald-500 flex-shrink-0\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\" /><path d=\"m9 12 2 2 4-4\" /></svg>\r\n                                </motion.div>\r\n                            )}\r\n                            <span className=\"text-zinc-200 font-medium truncate text-sm\">{row.customer}</span>\r\n                        </div>\r\n\r\n                        {/* Amount */}\r\n                        <div className=\"w-1/5 text-right text-white font-mono font-bold tracking-tight\">{row.amount}</div>\r\n\r\n                        {/* Status + Last Action */}\r\n                        <div className=\"w-1/3 flex flex-col items-center gap-1.5\">\r\n                            <div className={`px-3 py-0.5 rounded-full text-[9px] font-bold border flex items-center gap-1.5 ${row.color} backdrop-blur-sm`}>\r\n                                {row.status === \"GATHERING DATA\" && (\r\n                                    <svg className=\"animate-spin h-2 w-2 text-amber-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                                        <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                                        <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                                    </svg>\r\n                                )}\r\n                                {row.status}\r\n                            </div>\r\n                            <div className=\"text-[9px] text-zinc-500 font-mono uppercase tracking-tighter\">{row.lastAction}</div>\r\n                        </div>\r\n                    </motion.div>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction QRMockup() {\r\n    const [verified, setVerified] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const interval = setInterval(() => {\r\n            setVerified(prev => !prev);\r\n        }, 4000);\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"w-full h-full flex rounded-xl overflow-hidden border border-white/10 bg-black relative group\">\r\n            {/* Background Binary Rain */}\r\n            <div className=\"absolute inset-0 opacity-20 pointer-events-none overflow-hidden font-mono text-[10px] text-[#0052FF] leading-3 whitespace-pre select-none flex flex-col\">\r\n                <motion.div\r\n                    animate={{ y: [\"-50%\", \"0%\"] }}\r\n                    transition={{ duration: 20, repeat: Infinity, ease: \"linear\" }}\r\n                >\r\n                    {Array(40).fill(\"0101101001 1001010110 1101010010 0101101101\").join(\"\\n\")}\r\n                    {\"\\n\"}\r\n                    {Array(40).fill(\"1101010010 0101101101 0101101001 1001010110\").join(\"\\n\")}\r\n                </motion.div>\r\n            </div>\r\n\r\n            {/* Left: Sidebar */}\r\n            <div className=\"w-1/3 border-r border-white/10 bg-zinc-900/50 p-4 space-y-3 z-10 backdrop-blur-sm\">\r\n                <div className=\"h-12 w-full bg-[#0052FF]/10 border border-[#0052FF]/30 rounded flex items-center px-3 gap-3\">\r\n                    <div className=\"relative w-2 h-2\">\r\n                        <div className=\"absolute inset-0 bg-[#0052FF] rounded-full animate-ping opacity-75\"></div>\r\n                        <div className=\"relative w-2 h-2 bg-[#0052FF] rounded-full\"></div>\r\n                    </div>\r\n                    <div className=\"flex flex-col gap-1\">\r\n                        <div className=\"h-1.5 w-16 bg-[#0052FF]/40 rounded\" />\r\n                        <div className=\"h-1.5 w-10 bg-[#0052FF]/20 rounded\" />\r\n                    </div>\r\n                </div>\r\n                <div className=\"h-12 w-full bg-zinc-800/30 rounded border border-white/5 animate-pulse\" />\r\n                <div className=\"h-12 w-full bg-zinc-800/30 rounded border border-white/5\" />\r\n            </div>\r\n\r\n            {/* Right: Security Stage */}\r\n            <div className=\"flex-1 flex flex-col items-center justify-center relative z-10 p-6\">\r\n\r\n                {/* Holographic Card */}\r\n                <div className=\"relative w-64 bg-zinc-900/80 backdrop-blur-xl border border-white/10 rounded-2xl p-5 mb-8 overflow-hidden shadow-2xl group-hover:border-[#0052FF]/30 transition-colors\">\r\n                    {/* Laser Scan Beam */}\r\n                    <motion.div\r\n                        animate={{ top: [\"-10%\", \"120%\"] }}\r\n                        transition={{ duration: 3, repeat: Infinity, ease: \"linear\" }}\r\n                        className=\"absolute left-0 w-full h-0.5 bg-[#4F46E5] shadow-[0_0_25px_#4F46E5] z-20\"\r\n                    />\r\n\r\n                    {/* Card Content */}\r\n                    <div className=\"flex justify-between items-center mb-6 border-b border-white/5 pb-3\">\r\n                        <div className=\"text-[9px] font-mono text-emerald-500 tracking-widest animate-pulse flex items-center gap-1\">\r\n                            <span className=\"w-1 h-1 bg-emerald-500 rounded-full\" />\r\n                            [ ENCRYPTED_SESSION ]\r\n                        </div>\r\n                        {/* Lock Icon SVG */}\r\n                        <svg className=\"w-3 h-3 text-zinc-500\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" /><path d=\"M7 11V7a5 5 0 0 1 10 0v4\" /></svg>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div>\r\n                            <div className=\"text-[9px] text-zinc-500 uppercase tracking-widest mb-1.5\">Customer Identity</div>\r\n                            <div className=\"font-mono text-white text-base tracking-wider\">s*******@gmail.com</div>\r\n                        </div>\r\n                        <div>\r\n                            <div className=\"text-[9px] text-zinc-500 uppercase tracking-widest mb-1.5\">Refund Reference</div>\r\n                            <div className=\"font-mono text-zinc-300 text-xs flex justify-between\">\r\n                                <span>#R-138-XQ9</span>\r\n                                <span className=\"text-zinc-600\">via API</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Verification Button */}\r\n                <button\r\n                    className={`relative overflow-hidden px-6 py-2.5 rounded-full font-bold text-xs tracking-wide transition-all duration-500 flex items-center gap-2 ${verified\r\n                        ? \"bg-emerald-500/10 text-emerald-400 border border-emerald-500/50 shadow-[0_0_20px_rgba(16,185,129,0.2)]\"\r\n                        : \"bg-[#0052FF] text-white border border-[#0052FF] shadow-[0_0_15px_rgba(0,82,255,0.4)]\"\r\n                        }`}\r\n                >\r\n                    {/* Shimmer Effect */}\r\n                    {!verified && (\r\n                        <motion.div\r\n                            animate={{ x: [\"-100%\", \"200%\"] }}\r\n                            transition={{ duration: 2, repeat: Infinity, ease: \"linear\", repeatDelay: 1 }}\r\n                            className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent skew-x-12\"\r\n                        />\r\n                    )}\r\n\r\n                    {verified ? (\r\n                        <>\r\n                            <svg className=\"w-3.5 h-3.5\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M20 6 9 17l-5-5\" /></svg>\r\n                            IDENTITY VERIFIED\r\n                        </>\r\n                    ) : (\r\n                        <>\r\n                            <Zap size={14} className=\"fill-current\" />\r\n                            VERIFYING IDENTITY...\r\n                        </>\r\n                    )}\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction Counter({ value }: { value: number }) {\r\n    const nodeRef = useRef<HTMLSpanElement>(null);\r\n\r\n    useEffect(() => {\r\n        const node = nodeRef.current;\r\n        if (!node) return;\r\n\r\n        const controls = animate(0, value, {\r\n            duration: 2,\r\n            onUpdate(value) {\r\n                node.textContent = Math.round(value).toLocaleString();\r\n            }\r\n        });\r\n\r\n        return () => controls.stop();\r\n    }, [value]);\r\n\r\n    return <span ref={nodeRef} />;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\Footer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\Hero.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle2' is defined but never used.","line":4,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport { motion, useMotionValue, useSpring, useTransform, AnimatePresence } from 'framer-motion';\r\nimport { ArrowRight, CheckCircle2, Search, User, Smartphone, CreditCard, Zap } from 'lucide-react';\r\n\r\nexport default function Hero() {\r\n    return (\r\n        <section className=\"relative w-full pt-32 pb-40 flex flex-col items-center justify-center perspective-[2000px] z-10\">\r\n\r\n            {/* 1. THE MASSIVE GLOW (Electric Blue) */}\r\n            <div className=\"absolute top-[-10%] left-1/2 -translate-x-1/2 w-[80%] h-[500px] rounded-full bg-[#0052FF]/20 blur-[120px] pointer-events-none\" />\r\n\r\n            {/* 2. TEXT CONTENT */}\r\n            <div className=\"container mx-auto px-4 text-center mb-20 relative z-20\">\r\n                <motion.h1\r\n                    initial={{ opacity: 0, y: 20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    className=\"text-5xl md:text-7xl font-bold tracking-tight text-white mb-6 leading-[1.1]\"\r\n                >\r\n                    Refund Instantly.<br />\r\n                    <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-white via-[#0052FF] to-blue-500 drop-shadow-[0_0_15px_rgba(0,82,255,0.5)]\">\r\n                        Gateway Balance is Zero.\r\n                    </span>\r\n                </motion.h1>\r\n\r\n                <motion.p\r\n                    initial={{ opacity: 0, y: 20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ delay: 0.1 }}\r\n                    className=\"text-lg md:text-xl text-zinc-400 max-w-2xl mx-auto mb-10\"\r\n                >\r\n                    Stop waiting for new sales. Process refunds directly from your bank account, automate COD payouts, and stop the &quot;Where is my money?&quot; emails forever.\r\n                </motion.p>\r\n\r\n                <motion.div\r\n                    initial={{ opacity: 0, y: 20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ delay: 0.2 }}\r\n                    className=\"flex flex-col sm:flex-row gap-4 justify-center\"\r\n                >\r\n                    <button className=\"px-8 py-4 bg-[#0052FF] hover:bg-[#0040DD] text-white font-bold rounded-full transition-all flex items-center justify-center gap-2 shadow-lg shadow-blue-500/25 group\">\r\n                        Start Free <ArrowRight size={20} className=\"group-hover:translate-x-1 transition-transform\" />\r\n                    </button>\r\n                    <button className=\"px-8 py-4 bg-zinc-900 border border-zinc-800 hover:bg-zinc-800 text-white font-medium rounded-full transition-all\">\r\n                        Book Demo\r\n                    </button>\r\n                </motion.div>\r\n            </div>\r\n\r\n            {/* 3. THE 3D INTERACTIVE PLAYGROUND */}\r\n            <InteractiveDashboard />\r\n\r\n        </section>\r\n    );\r\n}\r\n\r\nfunction InteractiveDashboard() {\r\n    const [currentSlide, setCurrentSlide] = useState(0);\r\n    const ref = useRef<HTMLDivElement>(null);\r\n\r\n    // Auto-cycle slides\r\n    useEffect(() => {\r\n        const timer = setInterval(() => {\r\n            setCurrentSlide((prev) => (prev + 1) % 3);\r\n        }, 5000);\r\n        return () => clearInterval(timer);\r\n    }, []);\r\n\r\n    // 3D Tilt Logic\r\n    const x = useMotionValue(0);\r\n    const y = useMotionValue(0);\r\n    const mouseXSpring = useSpring(x);\r\n    const mouseYSpring = useSpring(y);\r\n    const rotateX = useTransform(mouseYSpring, [-0.5, 0.5], [\"7deg\", \"-7deg\"]);\r\n    const rotateY = useTransform(mouseXSpring, [-0.5, 0.5], [\"-7deg\", \"7deg\"]);\r\n\r\n    const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {\r\n        if (!ref.current) return;\r\n        const rect = ref.current.getBoundingClientRect();\r\n        const width = rect.width;\r\n        const height = rect.height;\r\n        const mouseX = e.clientX - rect.left;\r\n        const mouseY = e.clientY - rect.top;\r\n        const xPct = mouseX / width - 0.5;\r\n        const yPct = mouseY / height - 0.5;\r\n        x.set(xPct);\r\n        y.set(yPct);\r\n    };\r\n\r\n    return (\r\n        <motion.div\r\n            ref={ref}\r\n            onMouseMove={handleMouseMove}\r\n            onMouseLeave={() => { x.set(0); y.set(0); }}\r\n            style={{ rotateX, rotateY, transformStyle: \"preserve-3d\" }}\r\n            initial={{ opacity: 0, scale: 0.8, rotateX: 20 }}\r\n            animate={{ opacity: 1, scale: 1, rotateX: 0 }}\r\n            transition={{ delay: 0.4, duration: 1 }}\r\n            className=\"relative mx-auto max-w-5xl h-[500px] w-[90%] md:w-full group z-20\"\r\n        >\r\n            {/* GLASS CONTAINER */}\r\n            <div className=\"absolute inset-0 bg-zinc-900/50 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl shadow-blue-900/20 overflow-hidden flex flex-col\">\r\n\r\n                {/* Header Mockup */}\r\n                <div className=\"h-12 border-b border-white/5 flex items-center justify-between px-6 bg-white/[0.02]\">\r\n                    <div className=\"flex gap-2\">\r\n                        <div className=\"w-3 h-3 rounded-full bg-red-500/20\" />\r\n                        <div className=\"w-3 h-3 rounded-full bg-yellow-500/20\" />\r\n                        <div className=\"w-3 h-3 rounded-full bg-green-500/20\" />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"w-64 h-8 bg-zinc-800/50 rounded-lg border border-white/5 flex items-center px-3 text-xs text-zinc-600\">\r\n                            <Search size={14} className=\"mr-2 opacity-50\" /> Search...\r\n                        </div>\r\n                        <div className=\"w-8 h-8 rounded-full bg-zinc-800/50 flex items-center justify-center text-zinc-500\">\r\n                            <User size={14} />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* SLIDER CONTENT */}\r\n                <div className=\"relative flex-1 w-full overflow-hidden\">\r\n                    <AnimatePresence mode=\"wait\">\r\n                        <motion.div\r\n                            key={currentSlide}\r\n                            initial={{ x: 50, opacity: 0 }}\r\n                            animate={{ x: 0, opacity: 1 }}\r\n                            exit={{ x: -50, opacity: 0 }}\r\n                            transition={{ duration: 0.5 }}\r\n                            className=\"absolute inset-0 p-6 flex flex-col\"\r\n                        >\r\n                            {currentSlide === 0 && <AnalyticsMockup />}\r\n                            {currentSlide === 1 && <TableMockup />}\r\n                            {currentSlide === 2 && <QRMockup />}\r\n                        </motion.div>\r\n                    </AnimatePresence>\r\n                </div>\r\n\r\n                {/* PAGINATION DOTS */}\r\n                <div className=\"h-10 border-t border-white/5 flex items-center justify-center gap-2\">\r\n                    {[0, 1, 2].map(i => (\r\n                        <div key={i} className={`h-1 rounded-full transition-all duration-300 ${i === currentSlide ? 'w-8 bg-[#0052FF]' : 'w-2 bg-zinc-700'}`} />\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* BACK GLOW */}\r\n            <div className=\"absolute -inset-10 bg-[#0052FF]/20 blur-[80px] -z-10 rounded-full opacity-50\" />\r\n        </motion.div>\r\n    );\r\n}\r\n\r\n// --- SUB COMPONENTS ---\r\n\r\nfunction AnalyticsMockup() {\r\n    return (\r\n        <div className=\"grid grid-cols-3 gap-6 h-full\">\r\n            <div className=\"col-span-2 bg-white/[0.02] rounded-lg border border-white/5 p-4 flex flex-col\">\r\n                <div className=\"h-4 w-32 bg-zinc-800/50 rounded mb-6\" />\r\n                <div className=\"flex-1 flex items-end gap-2 px-2\">\r\n                    {[40, 70, 50, 90, 60, 80, 50, 70].map((h, i) => (\r\n                        <div key={i} className=\"flex-1 bg-[#0052FF]/20 border-t border-[#0052FF]/50 rounded-t-sm\" style={{ height: `${h}%` }} />\r\n                    ))}\r\n                </div>\r\n            </div>\r\n            <div className=\"col-span-1 flex flex-col gap-4\">\r\n                <div className=\"flex-1 bg-white/[0.02] rounded-lg border border-white/5 p-4 relative overflow-hidden\">\r\n                    <div className=\"absolute top-0 right-0 p-3\"><CreditCard className=\"text-zinc-700\" size={20} /></div>\r\n                    <div className=\"mt-auto\">\r\n                        <div className=\"text-2xl font-bold text-white\">‚Çπ1.2L</div>\r\n                        <div className=\"text-xs text-zinc-500\">Total Settled</div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex-1 bg-white/[0.02] rounded-lg border border-white/5 p-4 relative overflow-hidden\">\r\n                    <div className=\"absolute top-0 right-0 p-3\"><Zap className=\"text-zinc-700\" size={20} /></div>\r\n                    <div className=\"mt-auto\">\r\n                        <div className=\"text-2xl font-bold text-emerald-400\">98%</div>\r\n                        <div className=\"text-xs text-zinc-500\">Success Rate</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction TableMockup() {\r\n    return (\r\n        <div className=\"w-full h-full bg-white/[0.02] rounded-lg border border-white/5 overflow-hidden flex flex-col\">\r\n            <div className=\"grid grid-cols-4 gap-4 p-4 border-b border-white/5 text-[10px] uppercase text-zinc-500 font-bold tracking-wider\">\r\n                <div className=\"col-span-2\">Order</div>\r\n                <div>Amount</div>\r\n                <div>Status</div>\r\n            </div>\r\n            {[1, 2, 3].map((i) => (\r\n                <div key={i} className=\"grid grid-cols-4 gap-4 p-4 border-b border-white/5 items-center\">\r\n                    <div className=\"col-span-2 flex items-center gap-3\">\r\n                        <div className=\"w-8 h-8 rounded bg-zinc-800/50\" />\r\n                        <div className=\"h-3 w-24 bg-zinc-800 rounded\" />\r\n                    </div>\r\n                    <div><div className=\"h-3 w-12 bg-zinc-800 rounded\" /></div>\r\n                    <div>\r\n                        <div className={`h-5 w-20 rounded-full border flex items-center justify-center text-[9px] font-bold ${i === 1 ? 'bg-[#0052FF]/10 text-[#0052FF] border-[#0052FF]/20' :\r\n                            i === 2 ? 'bg-purple-500/10 text-purple-500 border-purple-500/20' :\r\n                                'bg-emerald-500/10 text-emerald-500 border-emerald-500/20'\r\n                            }`}>\r\n                            {i === 1 ? 'INITIATED' : i === 2 ? 'PROCESSING' : 'SETTLED'}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            ))}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction QRMockup() {\r\n    return (\r\n        <div className=\"w-full h-full flex overflow-hidden rounded-lg border border-white/5 bg-zinc-900/50\">\r\n            {/* LIST SIDE */}\r\n            <div className=\"w-1/3 border-r border-white/5 bg-white/[0.02] p-3 flex flex-col gap-2\">\r\n                <div className=\"h-2 w-16 bg-zinc-800 rounded mb-2 opacity-50\" />\r\n                <div className=\"h-10 w-full bg-zinc-800/50 rounded border border-white/5\" />\r\n                <div className=\"h-10 w-full bg-[#0052FF]/10 border border-[#0052FF]/30 rounded flex items-center px-2 relative\">\r\n                    <div className=\"w-1 h-4 bg-[#0052FF] rounded-full mr-2\" />\r\n                    <div className=\"h-2 w-12 bg-[#0052FF]/40 rounded\" />\r\n                </div>\r\n                <div className=\"h-10 w-full bg-zinc-800/50 rounded border border-white/5\" />\r\n            </div>\r\n\r\n            {/* DETAILS SIDE */}\r\n            <div className=\"flex-1 p-6 flex flex-col items-center justify-center relative\">\r\n                <div className=\"text-center mb-4\">\r\n                    <div className=\"text-[10px] uppercase tracking-widest text-zinc-500 font-bold mb-1\">Paying Refund #R-138</div>\r\n                    <div className=\"text-2xl font-mono font-bold text-white\">‚Çπ2,000.00</div>\r\n                </div>\r\n                <div className=\"p-3 bg-white rounded-lg shadow-xl shadow-blue-900/20 mb-4\">\r\n                    <div className=\"w-24 h-24 border-2 border-dashed border-zinc-300 rounded flex items-center justify-center\">\r\n                        <Smartphone className=\"text-zinc-900 opacity-20\" size={32} />\r\n                    </div>\r\n                </div>\r\n                <button className=\"px-4 py-2 bg-[#0052FF] hover:bg-[#0040DD] text-white text-xs font-bold rounded-full shadow-lg shadow-blue-500/20 flex items-center gap-2 transition-all\">\r\n                    <Zap size={12} /> Simulate Payment\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\HowItWorks.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\InteractiveBackground.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\LeadCaptureModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\LegalWrapper.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\MouseSpotlight.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\Navbar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'openLeadModal' is assigned a value but never used.","line":11,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState } from 'react';\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport { motion, useScroll, useMotionValueEvent } from 'framer-motion';\r\n\r\nimport { useModal } from '@/context/ModalContext';\r\n\r\n// 2. Destructure Prop\r\nexport default function Navbar() {\r\n    const { openLeadModal } = useModal();\r\n    const [scrolled, setScrolled] = useState(false);\r\n    const { scrollY } = useScroll();\r\n\r\n    useMotionValueEvent(scrollY, \"change\", (latest) => {\r\n        setScrolled(latest > 20);\r\n    });\r\n\r\n    return (\r\n        <motion.nav\r\n            className={`fixed top-0 w-full z-50 transition-all duration-500 ${scrolled\r\n                ? 'bg-[#0A0A0A]/80 backdrop-blur-xl border-b border-white/5 py-4'\r\n                : 'bg-transparent border-transparent py-6'\r\n                }`}\r\n        >\r\n            <div className=\"container mx-auto px-6 flex items-center justify-between\">\r\n\r\n                {/* Logo Home Link */}\r\n                <Link href=\"/\" className=\"flex items-center gap-2 cursor-pointer z-50\">\r\n                    <div className=\"relative h-11 w-48\">\r\n                        <Image\r\n                            src=\"/logo-white.png\"\r\n                            alt=\"Ryyt\"\r\n                            fill\r\n                            className=\"object-contain object-left\"\r\n                            priority\r\n                            onError={(e) => {\r\n                                e.currentTarget.style.display = 'none';\r\n                            }}\r\n                        />\r\n                    </div>\r\n                </Link>\r\n\r\n                {/* Desktop Links */}\r\n                <div className=\"hidden md:flex items-center gap-8 text-sm font-medium text-zinc-400\">\r\n                    <Link href=\"#features\" className=\"hover:text-white transition-colors\">Solutions</Link>\r\n                    <Link href=\"#why-us\" className=\"hover:text-white transition-colors\">Why Ryyt</Link>\r\n                    <Link href=\"#faq\" className=\"hover:text-white transition-colors\">FAQ</Link>\r\n                    <Link href=\"/blog\" className=\"hover:text-white transition-colors\">Blog</Link>\r\n                </div>\r\n\r\n                {/* Actions */}\r\n                <div className=\"flex items-center gap-4\">\r\n                    <Link href=\"/login\" className=\"text-sm font-medium text-zinc-300 hover:text-white transition-colors\">\r\n                        Login\r\n                    </Link>\r\n\r\n                    {/* 3. The Fixed Button */}\r\n                    <Link\r\n                        href=\"/signup\"\r\n                        className=\"text-sm font-medium px-5 py-2.5 rounded-full bg-[#0052FF] text-white hover:bg-[#0040DD] shadow-lg shadow-blue-900/20 transition-all\"\r\n                    >\r\n                        Get Started\r\n                    </Link>\r\n                </div>\r\n            </div>\r\n        </motion.nav>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\Pricing.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\ProblemSection.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":30,"column":79,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1887,1902],"text":"The &quot;WISMR\" Tax"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1887,1902],"text":"The &ldquo;WISMR\" Tax"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1887,1902],"text":"The &#34;WISMR\" Tax"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1887,1902],"text":"The &rdquo;WISMR\" Tax"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":30,"column":85,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1887,1902],"text":"The \"WISMR&quot; Tax"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1887,1902],"text":"The \"WISMR&ldquo; Tax"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1887,1902],"text":"The \"WISMR&#34; Tax"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1887,1902],"text":"The \"WISMR&rdquo; Tax"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nexport default function ProblemSection() {\r\n    return (\r\n        <section className=\"py-32 px-6 relative z-10\">\r\n            <div className=\"max-w-7xl mx-auto\">\r\n\r\n                {/* Section Header */}\r\n                <div className=\"text-center max-w-3xl mx-auto mb-20\">\r\n                    <h2 className=\"text-4xl md:text-5xl font-bold mb-6 leading-tight\">\r\n                        You take payments in seconds. <br />\r\n                        <span className=\"text-gray-500\">Refunds take 7 days.</span>\r\n                    </h2>\r\n                    <p className=\"text-xl text-gray-400 leading-relaxed\">\r\n                        The <span className=\"text-white font-medium\">&quot;Velocity Mismatch&quot;</span> creates a black box where money disappears.\r\n                        Your customer thinks you&apos;re a scammer. You&apos;re just waiting for the bank.\r\n                    </p>\r\n                </div>\r\n\r\n                {/* The 3 Villains Grid */}\r\n                <div className=\"grid md:grid-cols-3 gap-8\">\r\n\r\n                    {/* Card 1: The Support Tax */}\r\n                    <div className=\"p-8 rounded-3xl bg-[#0A0A0A] border border-white/5 hover:border-white/10 transition-colors group\">\r\n                        <div className=\"w-12 h-12 bg-red-500/10 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform duration-300\">\r\n                            <svg className=\"w-6 h-6 text-red-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\" />\r\n                            </svg>\r\n                        </div>\r\n                        <h3 className=\"text-xl font-bold text-white mb-3\">The \"WISMR\" Tax</h3>\r\n                        <p className=\"text-gray-400 leading-relaxed\">\r\n                            <span className=\"text-white font-medium\">60%</span> of your support tickets are &quot;Where Is My Refund?&quot;.\r\n                            Each ticket costs you <span className=\"text-white font-medium\">‚Çπ50-‚Çπ200</span> to resolve, bleeding your margins dry on orders you already lost.\r\n                        </p>\r\n                    </div>\r\n\r\n                    {/* Card 2: The Data Silo */}\r\n                    <div className=\"p-8 rounded-3xl bg-[#0A0A0A] border border-white/5 hover:border-white/10 transition-colors group\">\r\n                        <div className=\"w-12 h-12 bg-orange-500/10 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform duration-300\">\r\n                            <svg className=\"w-6 h-6 text-orange-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\" />\r\n                            </svg>\r\n                        </div>\r\n                        <h3 className=\"text-xl font-bold text-white mb-3\">The Data Black Box</h3>\r\n                        <p className=\"text-gray-400 leading-relaxed\">\r\n                            Logistics knows it&apos;s picked up. The Gateway knows it&apos;s initiated. The Bank knows it&apos;s settled.\r\n                            <span className=\"text-white font-medium\"> None of them talk to each other.</span> You are left blind, unable to prove you&apos;ve paid.\r\n                        </p>\r\n                    </div>\r\n\r\n                    {/* Card 3: The Liquidity Trap */}\r\n                    <div className=\"p-8 rounded-3xl bg-[#0A0A0A] border border-white/5 hover:border-white/10 transition-colors group\">\r\n                        <div className=\"w-12 h-12 bg-purple-500/10 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform duration-300\">\r\n                            <svg className=\"w-6 h-6 text-purple-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                            </svg>\r\n                        </div>\r\n                        <h3 className=\"text-xl font-bold text-white mb-3\">The Liquidity Trap</h3>\r\n                        <p className=\"text-gray-400 leading-relaxed\">\r\n                            Daily payouts leave your balance at zero. Refunds get stuck in <span className=\"text-white font-medium\">&quot;Pending&quot;</span>\r\n                            until new sales come in. You can&apos;t pay because the system won&apos;t let you top up.\r\n                        </p>\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\SocialProof.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\TestimonialsMarquee.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\marketing\\WhyUs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\ui\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\ui\\Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\components\\ui\\Input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\config\\chatbotData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\config\\features.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\config\\plans.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\context\\ModalContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\data\\mock-refunds.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\hooks\\useDashboardMetrics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\lib\\AuthContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\lib\\billingService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\lib\\blog.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\lib\\chatbotEngine.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SALES_NUDGES' is defined but never used.","line":1,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Scenario' is defined but never used.","line":1,"column":73,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":81}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { SCENARIO_MAP, KEYWORD_MAP, SALES_NUDGES, LEAD_CAPTURE_SUCCESS, Scenario } from \"@/config/chatbotData\";\r\nimport { saveLead } from \"@/lib/leadService\";\r\n\r\n/**\r\n * Smart Librarian Engine (Navigator Edition)\r\n * Scenario-Based State Machine\r\n */\r\nconst GREETINGS = [\"hi\", \"hello\", \"hey\", \"good morning\", \"good evening\", \"namaste\"];\r\n\r\n// Response Interface\r\nexport interface BotResponse {\r\n    text: string;\r\n    actions: { label: string; nextId: string }[];\r\n    captureLead?: boolean;\r\n}\r\n\r\nexport async function getBotResponse(\r\n    input: string,\r\n    isLoggedIn: boolean,\r\n    interestContext: string = \"General\",\r\n    scenarioId?: string\r\n): Promise<BotResponse> {\r\n\r\n    const cleanMsg = input.toLowerCase().trim();\r\n\r\n    // 1. Lead Capture Priority (Email + Phone)\r\n    // CRITICAL: Check this BEFORE any other logic.\r\n    if (!isLoggedIn) {\r\n        const emailRegex = /[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,}/gi;\r\n        const phoneRegex = /(?:\\+?91)?[6-9]\\d{9}/g;\r\n\r\n        const emailMatches = cleanMsg.match(emailRegex) || [];\r\n        const phoneMatches = cleanMsg.match(phoneRegex) || [];\r\n        const contacts = Array.from(new Set([...emailMatches, ...phoneMatches]));\r\n\r\n        if (contacts.length > 0) {\r\n            console.log(\"Lead Detected in Input:\", contacts); // Debugging for Founder\r\n\r\n            let leadCaptured = false;\r\n            for (const contact of contacts) {\r\n                try {\r\n                    console.log(\"Attempting to save lead:\", contact);\r\n                    await saveLead(contact, interestContext);\r\n                    leadCaptured = true;\r\n                } catch (err: unknown) {\r\n                    console.error(\"Failed to save lead\", contact, err);\r\n                }\r\n            }\r\n\r\n            if (leadCaptured) {\r\n                return {\r\n                    text: LEAD_CAPTURE_SUCCESS,\r\n                    actions: [],\r\n                    captureLead: true\r\n                };\r\n            }\r\n        }\r\n    }\r\n\r\n    // 2. Direct Scenario Navigation (Button Click)\r\n    if (scenarioId && SCENARIO_MAP[scenarioId]) {\r\n        const scenario = SCENARIO_MAP[scenarioId];\r\n        return {\r\n            text: scenario.message,\r\n            actions: scenario.options\r\n        };\r\n    }\r\n\r\n    // 3. Handle Greetings\r\n    if (GREETINGS.some(g => cleanMsg === g)) {\r\n        const root = SCENARIO_MAP[\"root\"];\r\n        return {\r\n            text: root.message,\r\n            actions: root.options\r\n        };\r\n    }\r\n\r\n    // 4. Keyword Matching -> Map to Scenario\r\n    for (const mapping of KEYWORD_MAP) {\r\n        if (mapping.keywords.some(kw => cleanMsg.includes(kw))) {\r\n            const scenario = SCENARIO_MAP[mapping.scenarioId];\r\n            return {\r\n                text: scenario.message,\r\n                actions: scenario.options\r\n            };\r\n        }\r\n    }\r\n\r\n    // 5. Fallback\r\n    const fallbackRoot = SCENARIO_MAP[\"root\"];\r\n    return {\r\n        text: \"I'm not exactly sure what you mean, but I can help you with these topics:\",\r\n        actions: fallbackRoot.options\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\lib\\db.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\lib\\firebase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\lib\\invoiceGenerator.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'safeDate' is assigned a value but never used.","line":248,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":248,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport jsPDF from \"jspdf\";\r\nimport autoTable from \"jspdf-autotable\";\r\nimport { calculateFinalBill } from \"./taxCalculator\";\r\n\r\n// 1. Strict Interfaces\r\nexport interface InvoiceMerchantData {\r\n    brandName: string;\r\n    email: string;\r\n    gstin?: string; // Optional GSTIN\r\n    address?: string; // Optional Address\r\n}\r\n\r\nexport interface InvoicePaymentData {\r\n    id?: string;\r\n    amount?: number; // Total Paid\r\n    planName?: string;\r\n    date?: { seconds: number } | Date | string | number;\r\n\r\n    // Hybrid Billing Details\r\n    basePrice?: number;\r\n    usageCount?: number;\r\n    limit?: number; // Included Refunds\r\n    excessRate?: number;\r\n    email?: string; // Optional override\r\n}\r\n\r\nexport const generateInvoice = (merchantData: InvoiceMerchantData, paymentData: InvoicePaymentData) => {\r\n    // 1. Guard against Server Side\r\n    if (typeof window === \"undefined\") return;\r\n\r\n    // 2. Prepare Data & Fallbacks\r\n    const brandName = merchantData.brandName || \"Merchant Partner\";\r\n    const totalAmount = paymentData.amount || 0;\r\n    const planName = paymentData.planName || \"Subscription\";\r\n    const email = merchantData.email || paymentData.email || \"shuvam@ryyt.in\";\r\n\r\n    // Date Logic\r\n    let dateObj = new Date();\r\n    if (paymentData.date) {\r\n        if (typeof paymentData.date === 'object' && 'seconds' in paymentData.date) {\r\n            dateObj = new Date(paymentData.date.seconds * 1000);\r\n        } else {\r\n            dateObj = new Date(paymentData.date);\r\n        }\r\n    }\r\n\r\n    const year = dateObj.getFullYear();\r\n    const month = String(dateObj.getMonth() + 1).padStart(2, '0');\r\n    const day = String(dateObj.getDate()).padStart(2, '0');\r\n    const dateStr = `${day}/${month}/${year}`;\r\n\r\n    // Professional ID Generation: CAL-[YYYY]-[MM]-[Sequence/Hash]\r\n    // Using last 4 chars of ID or random if missing to simulate sequence\r\n    const uniqueSuffix = paymentData.id ? paymentData.id.slice(-4).toUpperCase() : Math.floor(1000 + Math.random() * 9000);\r\n    const displayInvoiceId = `CAL-${year}-${month}-${uniqueSuffix}`;\r\n\r\n    // 3. Initialize jsPDF\r\n    const doc = new jsPDF('p', 'mm', 'a4');\r\n\r\n    // 4. ELITE BRANDING HEADER\r\n    // Left: Product Brand\r\n    doc.setFontSize(26);\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.setTextColor(40, 40, 40);\r\n    doc.text(\"RYYT\", 14, 22);\r\n\r\n    doc.setFontSize(10);\r\n    doc.setFont(\"helvetica\", \"normal\");\r\n    doc.setTextColor(100, 100, 100);\r\n    doc.text(\"Automated Refund Infrastructure\", 14, 28);\r\n\r\n    // Right: Invoice Meta Block\r\n    const metaX = 140;\r\n    doc.setFontSize(20);\r\n    doc.setTextColor(79, 70, 229); // Ryyt Indigo\r\n    doc.text(\"INVOICE\", metaX, 22);\r\n\r\n    doc.setFontSize(10);\r\n    doc.setTextColor(100, 100, 100);\r\n\r\n    doc.text(\"Invoice #:\", metaX, 32);\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.text(displayInvoiceId, metaX + 25, 32);\r\n\r\n    doc.setTextColor(100, 100, 100);\r\n    doc.text(\"Date:\", metaX, 38);\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.text(dateStr, metaX + 25, 38);\r\n\r\n    doc.setTextColor(100, 100, 100);\r\n    doc.text(\"Status:\", metaX, 44);\r\n    doc.setTextColor(34, 197, 94); // Green Safe\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.text(\"PAID\", metaX + 25, 44);\r\n\r\n    // 5. ADDRESS BLOCKS\r\n    const sectionY = 60;\r\n\r\n    // From (Calcure)\r\n    doc.setFontSize(9);\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.setTextColor(120, 120, 120);\r\n    doc.text(\"FROM\", 14, sectionY);\r\n\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.setFontSize(10);\r\n    doc.text(\"Calcure Technologies Private Limited\", 14, sectionY + 6);\r\n\r\n    doc.setFont(\"helvetica\", \"normal\");\r\n    doc.setTextColor(80, 80, 80);\r\n    doc.text(\"3 no. Basunagar, Madhaymgram\", 14, sectionY + 11);\r\n    doc.text(\"Kolkata 700129\", 14, sectionY + 16);\r\n    doc.text(\"support@ryyt.in\", 14, sectionY + 21);\r\n\r\n    // To (Merchant)\r\n    doc.setFontSize(9);\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.setTextColor(120, 120, 120);\r\n    doc.text(\"BILL TO\", 110, sectionY);\r\n\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.setFontSize(10);\r\n    doc.text(brandName, 110, sectionY + 6);\r\n\r\n    doc.setFont(\"helvetica\", \"normal\");\r\n    doc.setTextColor(80, 80, 80);\r\n    // Address if available, else plain email\r\n    if (merchantData.address) doc.text(merchantData.address, 110, sectionY + 11);\r\n    doc.text(email, 110, sectionY + (merchantData.address ? 16 : 11));\r\n    if (merchantData.gstin) doc.text(`GSTIN: ${merchantData.gstin}`, 110, sectionY + (merchantData.address ? 21 : 16));\r\n\r\n\r\n    // 6. HYBRID LINE ITEMS LOGIC\r\n    const tableBody = [];\r\n\r\n    // Item 1: Base Subscription\r\n    // If basePrice is provided, use it. Else validation fallback logic could go here, \r\n    // but we assume paymentData implies a fulfilled cycle or prepaid start.\r\n    const basePrice = paymentData.basePrice !== undefined ? paymentData.basePrice : totalAmount;\r\n    // Note: If strictly usage based, base might be 0, but usually it's a plan price.\r\n\r\n    tableBody.push([\r\n        `Software Subscription - ${planName.charAt(0).toUpperCase() + planName.slice(1)} (Prepaid)`,\r\n        \"1 Month\",\r\n        `Rs. ${basePrice.toLocaleString()}`\r\n    ]);\r\n\r\n    // Item 2: Overage (Conditional)\r\n    if (\r\n        paymentData.usageCount !== undefined &&\r\n        paymentData.limit !== undefined &&\r\n        paymentData.usageCount > paymentData.limit\r\n    ) {\r\n        const excess = paymentData.usageCount - paymentData.limit;\r\n        const rate = paymentData.excessRate || 15; // Default fallback\r\n        const overageCost = excess * rate;\r\n\r\n        tableBody.push([\r\n            `Usage Overage (Previous Cycle: ${paymentData.usageCount} refunds)`,\r\n            `${excess} @ Rs.${rate}`,\r\n            `Rs. ${overageCost.toLocaleString()}`\r\n        ]);\r\n    }\r\n\r\n    // 6.5 Calculate GST Breakdown\r\n    const { subtotal, gstAmount, total: grandTotal } = calculateFinalBill(basePrice + (paymentData.usageCount && paymentData.limit && paymentData.usageCount > paymentData.limit ? (paymentData.usageCount - paymentData.limit) * (paymentData.excessRate || 15) : 0));\r\n    // Fallback if paymentData.amount was already stored as total inclusive in DB\r\n    const finalTotal = paymentData.amount || grandTotal;\r\n\r\n    // 7. GENERATE TABLE\r\n    autoTable(doc, {\r\n        startY: 95,\r\n        head: [['Item Description', 'Qty / Detail', 'Amount (INR)']],\r\n        body: tableBody,\r\n        theme: 'grid',\r\n        headStyles: {\r\n            fillColor: [79, 70, 229], // Indigo-600\r\n            textColor: 255,\r\n            fontSize: 10,\r\n            fontStyle: 'bold',\r\n            halign: 'left',\r\n            cellPadding: 8\r\n        },\r\n        styles: {\r\n            fontSize: 10,\r\n            cellPadding: 8,\r\n            textColor: [50, 50, 50],\r\n            lineColor: [230, 230, 230],\r\n            lineWidth: 0.1\r\n        },\r\n        columnStyles: {\r\n            0: { cellWidth: 100 },\r\n            1: { cellWidth: 40 },\r\n            2: { cellWidth: 40, halign: 'right', fontStyle: 'bold' }\r\n        },\r\n        bodyStyles: {\r\n            halign: 'left'\r\n        },\r\n        // Adding the tax breakdown rows\r\n        foot: [\r\n            [\r\n                { content: 'Subtotal:', colSpan: 2, styles: { halign: 'right', fontSize: 10, fontStyle: 'normal' } },\r\n                { content: `Rs. ${subtotal.toLocaleString()}`, styles: { halign: 'right', fontSize: 10, fontStyle: 'normal' } }\r\n            ],\r\n            [\r\n                { content: 'GST (18%):', colSpan: 2, styles: { halign: 'right', fontSize: 10, fontStyle: 'normal' } },\r\n                { content: `Rs. ${gstAmount.toLocaleString()}`, styles: { halign: 'right', fontSize: 10, fontStyle: 'normal' } }\r\n            ],\r\n            [\r\n                { content: 'Grand Total (Inclusive of Tax):', colSpan: 2, styles: { halign: 'right', fontSize: 12, fontStyle: 'bold' } },\r\n                { content: `Rs. ${finalTotal.toLocaleString()}`, styles: { halign: 'right', fontSize: 12, fontStyle: 'bold', textColor: [0, 0, 0] } }\r\n            ]\r\n        ],\r\n        footStyles: {\r\n            fillColor: [249, 250, 251], // Gray-50\r\n            textColor: [0, 0, 0],\r\n            lineColor: [230, 230, 230],\r\n            lineWidth: 0.1\r\n        }\r\n    });\r\n\r\n    // 8. FOOTER\r\n    const finalY = (doc as jsPDF & { lastAutoTable: { finalY: number } }).lastAutoTable?.finalY || 120;\r\n\r\n    doc.setFontSize(9);\r\n    doc.setTextColor(100, 100, 100);\r\n    doc.setFont(\"helvetica\", \"normal\");\r\n\r\n    // Divider\r\n    doc.setDrawColor(230, 230, 230);\r\n    doc.line(14, finalY + 15, 196, finalY + 15);\r\n\r\n    doc.text(\"Terms & Conditions:\", 14, finalY + 22);\r\n    doc.setFontSize(8);\r\n    doc.text(\"1. This is a computer-generated invoice and serves as a valid proof of payment.\", 14, finalY + 27);\r\n    doc.text(\"2. Calcure Technologies Private Limited is a registered entity in India.\", 14, finalY + 32);\r\n\r\n    doc.setFontSize(8);\r\n    doc.setTextColor(150, 150, 150);\r\n    doc.text(\"Issued by Calcure Technologies Private Limited\", 14, 280); // Bottom of page\r\n\r\n    // 9. SAVE\r\n    const safeBrandName = brandName.replace(/[^a-zA-Z0-9]/g, \"_\");\r\n    const safeDate = dateStr.replace(/\\//g, \"-\");\r\n    const filename = `Invoice_${safeBrandName}_${displayInvoiceId}.pdf`;\r\n\r\n    doc.save(filename);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\lib\\leadService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\lib\\metrics.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'previousStatus' is defined but never used.","line":15,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from \"./firebase\";\r\nimport { doc, updateDoc, increment, serverTimestamp } from \"firebase/firestore\";\r\n\r\nexport type MetricChangeType = \"NEW_REFUND\" | \"SETTLE_REFUND\" | \"FAIL_REFUND\" | \"VOID_REFUND\";\r\n\r\n/**\r\n * updateScoreboard\r\n * Atomically updates the metadata metrics for a merchant.\r\n * Designed to be called safely; failure here does not block the primary save.\r\n */\r\nexport async function updateScoreboard(\r\n    merchantId: string,\r\n    changeType: MetricChangeType,\r\n    amount: number,\r\n    previousStatus?: string\r\n) {\r\n    if (!merchantId) return;\r\n\r\n    try {\r\n        const metricsRef = doc(db, \"merchants\", merchantId, \"metadata\", \"metrics\");\r\n\r\n        // Use unknown to accommodate FieldValue/Timestamp mixed types safely\r\n        let updates: Record<string, unknown> = {\r\n            lastUpdated: serverTimestamp(),\r\n        };\r\n\r\n        switch (changeType) {\r\n            case \"NEW_REFUND\":\r\n                // 1. Initial State: Always adds to Total and Active Liability (unless it starts as Failed/Settled which is rare)\r\n                updates = {\r\n                    ...updates,\r\n                    totalRefundsCount: increment(1),\r\n                    activeLiabilityAmount: increment(amount),\r\n                };\r\n                break;\r\n\r\n            case \"SETTLE_REFUND\":\r\n                // 2. Settlement Logic: Moves from Liability to Settled Amount\r\n                updates = {\r\n                    ...updates,\r\n                    activeLiabilityAmount: increment(-amount),\r\n                    totalSettledAmount: increment(amount),\r\n                };\r\n                break;\r\n\r\n            case \"FAIL_REFUND\":\r\n                // 3. Failure Logic: Moves from Liability to Stuck Amount\r\n                updates = {\r\n                    ...updates,\r\n                    activeLiabilityAmount: increment(-amount),\r\n                    stuckAmount: increment(amount),\r\n                    failedCount: increment(1),\r\n                };\r\n                break;\r\n\r\n            case \"VOID_REFUND\":\r\n                // 4. Void Logic: Subtracts from Liability and Total Count\r\n                updates = {\r\n                    ...updates,\r\n                    activeLiabilityAmount: increment(-amount),\r\n                    totalRefundsCount: increment(-1),\r\n                };\r\n                break;\r\n        }\r\n\r\n        await updateDoc(metricsRef, updates);\r\n        console.log(`[Metrics] Successfully updated ${changeType} for merchant: ${merchantId}`);\r\n\r\n    } catch (error) {\r\n        // CRITICAL: We catch all errors so the UI/User flow is never blocked by a metrics failure\r\n        console.error(\"[Metrics Error] Failed to update scoreboard:\", error);\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\lib\\notificationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\lib\\payoutService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\lib\\taxCalculator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\scripts\\backfillMerchants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\scripts\\migrateMetrics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\src\\types\\refund.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\shuva\\OneDrive\\Desktop\\Ryyt Workspace\\refund-app\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]